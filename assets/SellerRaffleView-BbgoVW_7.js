import{d as me,am as _e,aD as ve,r as c,y as I,a0 as ge,aE as xe,a1 as he,o as n,c as b,a as s,t as u,e as t,aF as we,F as A,i as L,b as r,w as l,B as v,_ as m,q as z,j as g,a5 as H,s as h,a6 as be,n as ye,an as ke}from"./index-qB8lAYve.js";import{S as P}from"./ticket-line-duotone-BPoqiscK.js";import{a as Z,b as J,c as K,d as Q,S as W,_ as X}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-B0jIFmuR.js";import{_ as ee,a as te}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-CgvRNT0f.js";import{n as Te}from"./strings-BzWVocVB.js";import{O as Se}from"./index-BCHauPhd.js";const Ce={class:"p-4 rounded-md mx-auto"},De={class:"flex justify-between items-center mb-4"},Ee={class:"text-primary text-2xl font-bold uppercase"},Ne={class:"text-2xl font-bold uppercase"},$e={class:"text-right max-w-80"},Re={class:"capitalize"},qe={class:"space-y-4"},Oe={class:"tabular-nums flex flex-row justify-center items-center self-start print:self-center"},je={class:"text-7xl text-primary print:text-7xl"},Be={class:"flex flex-wrap gap-2"},Ie={class:"pointer-events-none"},Ae={class:"w-full flex flex-col print:flex-row gap-4"},Le={class:"w-full flex items-center gap-4 border p-4 rounded-md"},Fe=s("h3",{class:"font-extrabold text-3xl text-primary"},"POOL",-1),Me={class:"flex flex-row flex-wrap gap-2"},Ve={class:"flex justify-end"},Ge={class:"flex flex-row print:flex-col items-center border rounded-md p-4 gap-4 text-right"},Ue=s("p",{class:"font-semibold text-lg"},"TOTAL",-1),Ye={class:"text-4xl font-extrabold text-primary"},ze={class:"flex flex-row gap-2 justify-start items-center"},He=s("span",null," Asignar Boletas ",-1),Pe={class:"px-6 py-4 overflow-y-auto relative max-h-[55dvh]"},Ze={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},Je=s("span",null,"Asignar",-1),Ke={class:"flex flex-row gap-2 justify-start items-center"},Qe=s("span",null," Remover Boleta ",-1),We={class:"flex flex-row gap-2 justify-center items-center p-4"},Xe=s("span",null,"Remover",-1),et=s("header",{class:"hidden print:block print:!fixed print:top-0"},"SÁNCHEZ INVERSIONES",-1),it=me({__name:"SellerRaffleView",setup(tt){const F=_e(),R=ve(),y=F.currentRoute.value.params.id,k=F.currentRoute.value.params.seller_id,T=c(),S=c(),M=c(),V=c([]),C=c([]),x=c(null),D=c(!1),E=c(!1),i=c(!1),N=c(""),q=c(null),se=I(()=>{const e=Array.from(new Set(C.value.map(d=>d.number[0]))).map(d=>({group:d,sellerTickets:C.value.filter(f=>f.number[0]===d)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(d=>{const f=e.find(w=>w.group===d.group);return f==null||f.sellerTickets.sort((w,$)=>Number(w.number)-Number($.number)),f||d})}),ae=I(()=>C.value.length),le=I(()=>(console.log(N.value),N.value?V.value.filter(a=>a.number[0]===N.value):[])),re=a=>{N.value=a,ke(()=>{D.value=!0})},oe=a=>{var e,_;(e=x.value)!=null&&e.includes(a.id)?x.value=(_=x.value)==null?void 0:_.filter(d=>d!==a.id):x.value=[...x.value??[],a.id]},ne=a=>{var e;return(e=x.value)==null?void 0:e.includes(a.id)},ie=async()=>{const{data:a,error:e}=await h.from("raffle_stats").select("*").eq("raffle_id",y).single();if(e)throw new Error(e.message);T.value=a},de=async()=>{const{data:a,error:e}=await h.from("sellers").select("*").eq("id",k).single();if(e)throw new Error(e.message);S.value=a},O=async()=>{const{data:a,error:e}=await h.from("tickets").select("*").eq("raffle_id",y).eq("seller_id",k);if(e)throw new Error(e.message);C.value=a},j=async()=>{const{data:a,error:e}=await h.from("tickets").select("*").eq("raffle_id",y).is("seller_id",null);if(e)throw new Error(e.message);V.value=a},B=async()=>{const{data:a,error:e}=await h.from("raffles_sellers").select("*").eq("raffle_id",y).eq("seller_id",k).single();if(e)throw new Error(e.message);M.value=a},ce=async()=>{var e;i.value=!0;const{error:a}=await h.from("tickets").update({seller_id:Number(k)}).in("id",(e=x.value)==null?void 0:e.map(_=>Number(_)));if(a)throw new Error(a.message);B(),j(),O(),i.value=!1,D.value=!1},ue=async a=>{i.value=!0;const{error:e}=await h.from("tickets").update({seller_id:null}).eq("id",a);if(e)throw new Error(e.message);B(),j(),O(),i.value=!1,E.value=!1},G=a=>{E.value=!0,q.value=a},fe=R.value;return ge(async()=>{var a,e;await ie(),await de(),await B(),await O(),await j(),R.value=`${(e=(a=S.value)==null?void 0:a.name)==null?void 0:e.toUpperCase()} - SANCHEZ INVERSIONES`}),xe(()=>{R.value=fe}),(a,e)=>{var d,f,w,$,U,Y;const _=he("auto-animate");return n(),b("div",Ce,[s("div",De,[s("div",null,[s("h1",Ee,u((d=T.value)==null?void 0:d.raffle_name),1),s("h2",Ne,u((f=S.value)==null?void 0:f.name),1),s("p",null,u((w=S.value)==null?void 0:w.phone),1)]),s("div",$e,[s("p",null,u(t(Te)(($=M.value)==null?void 0:$.ticket_price)),1),s("p",null,u((U=T.value)==null?void 0:U.lottery_name),1),s("p",Re,u(t(we)(new Date(Date.parse((Y=T.value)==null?void 0:Y.draw_drawn_at)),"dddd DD [de] MMMM [de] YYYY")),1)])]),s("div",qe,[(n(!0),b(A,null,L(se.value,o=>(n(),b("div",{key:o.group,class:"flex items-center gap-4 print:gap-1 border p-4 print:p-2 rounded-md break-before-auto"},[s("div",Oe,[s("h3",je,u(o.group),1)]),s("div",Be,[(n(!0),b(A,null,L(o.sellerTickets,p=>(n(),g(t(Se),{key:p.id,as:"button",class:"ml-2 button small",onTrigger:pe=>G(p)},{default:l(()=>[r(t(m),{variant:"ghost",onContextmenu:be(pe=>G(p),["prevent"]),class:"border-primary print:min-w-10 print:min-h-10 print:w-10 print:h-10 print:text-sm print:font-extrabold print:rounded-md text-lg min-w-14 min-h-14 w-14 h-14 border rounded-full flex-col justify-center items-center"},{default:l(()=>[s("span",Ie,u(p.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),r(t(m),{onClick:p=>re(o.group),variant:"ghost",class:"print:hidden text-lg w-14 h-14 border rounded-full"},{default:l(()=>[v(" + ")]),_:2},1032,["onClick"])])]))),128)),s("div",Ae,[s("div",Le,[Fe,s("div",Me,[r(t(m),{variant:"ghost",class:"print:hidden text-lg w-14 h-14 border"},{default:l(()=>[v(" + ")]),_:1})])]),s("div",Ve,[s("div",Ge,[Ue,s("p",Ye,u(ae.value),1)])])])]),r(t(X),{open:D.value,"onUpdate:open":e[0]||(e[0]=o=>D.value=o)},{default:l(()=>[r(t(Z),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(t(J),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(t(K),null,{default:l(()=>[s("div",ze,[r(t(P),{class:"w-8 h-8"}),He])]),_:1}),r(t(Q),null,{default:l(()=>[v(" Seleccione una o más boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),s("div",Pe,[s("div",Ze,[(n(!0),b(A,null,L(le.value,o=>(n(),g(t(m),{key:o.id,variant:"ghost",class:ye(["text-lg w-14 h-14 border rounded-full",{"bg-green-600 hover:bg-green-700":ne(o)}]),onClick:p=>oe(o),disabled:i.value},{default:l(()=>[v(u(o.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),r(t(ee),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(t(te),{"as-child":""},{default:l(()=>[r(t(m),{variant:"secondary",type:"button",disabled:i.value},{default:l(()=>[v("Cancelar")]),_:1},8,["disabled"])]),_:1}),z((n(),g(t(m),{onClick:ce,class:"gap-3",form:"raffle-form",type:"submit",disabled:i.value},{default:l(()=>[i.value?(n(),g(t(H),{key:0,class:"h-6 w-6"})):(n(),g(t(W),{key:1,class:"w-6 h-6"})),Je]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"]),r(t(X),{open:E.value,"onUpdate:open":e[2]||(e[2]=o=>E.value=o)},{default:l(()=>[r(t(Z),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(t(J),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(t(K),null,{default:l(()=>[s("div",Ke,[r(t(P),{class:"w-8 h-8"}),Qe])]),_:1}),r(t(Q),null,{default:l(()=>[v(" Esta acción removerá la boleta de este vendedor ")]),_:1})]),_:1}),s("div",We,[r(t(m),{variant:"ghost",class:"text-4xl w-32 h-32 border rounded-full",disabled:i.value},{default:l(()=>{var o;return[v(u((o=q.value)==null?void 0:o.number),1)]}),_:1},8,["disabled"])]),r(t(ee),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(t(te),{"as-child":""},{default:l(()=>[r(t(m),{variant:"secondary",type:"button",disabled:i.value},{default:l(()=>[v("Cancelar")]),_:1},8,["disabled"])]),_:1}),z((n(),g(t(m),{onClick:e[1]||(e[1]=o=>{var p;return ue((p=q.value)==null?void 0:p.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:i.value},{default:l(()=>[i.value?(n(),g(t(H),{key:0,class:"h-6 w-6"})):(n(),g(t(W),{key:1,class:"w-6 h-6"})),Xe]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"]),et])}}});export{it as default};
