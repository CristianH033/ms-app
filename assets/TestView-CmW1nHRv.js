var g=Object.defineProperty;var v=(n,e,t)=>e in n?g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>v(n,typeof e!="symbol"?e+"":e,t);import{L as w}from"./LazyImg-Dhax-9uv.js";import{d as j,r as c,a0 as $,o as p,c as l,a as f,F as _,i as C,n as x,b as I}from"./index-DFj68BHw.js";import"./thumbHash-Ci89Ad7b.js";import"./Skeleton.vue_vue_type_script_setup_true_lang-BByHNGjx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";class P{constructor(e="http://localhost:3000"){u(this,"baseURL");this.baseURL=e}async fetchWithPriority(e,t){const{priority:o,...s}=t;o&&(s.priority=o);const r=await fetch(e,s);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r}async index(e={},t="auto"){const o=this.buildQueryParams(e);return(await this.fetchWithPriority(`${this.baseURL}/images${o}`,{method:"GET",headers:{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},priority:t})).json()}async show(e,t="auto"){return(await this.fetchWithPriority(`${this.baseURL}/images/${e}`,{method:"GET",headers:{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},priority:t})).json()}async create(e,t="auto"){return(await this.fetchWithPriority(`${this.baseURL}/images`,{method:"POST",headers:{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},body:JSON.stringify({data:e}),priority:t})).json()}async update(e,t,o="auto"){return(await this.fetchWithPriority(`${this.baseURL}/images/${e}`,{method:"PATCH",headers:{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},body:JSON.stringify({data:t}),priority:o})).json()}async delete(e,t="auto"){return(await this.fetchWithPriority(`${this.baseURL}/images/${e}`,{method:"DELETE",headers:{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"},priority:t})).json()}buildQueryParams(e){const t=[];if(e.filter&&t.push(Object.entries(e.filter).map(([o,s])=>`${o}=${encodeURIComponent(s)}`).join("&")),e.sort){const o=Array.isArray(e.sort)?e.sort.join(","):e.sort;t.push(`_sort=${encodeURIComponent(o)}`)}return e.order&&t.push(`_order=${encodeURIComponent(e.order)}`),e.page&&(t.push(`_page=${e.page.number}`),e.page.limit&&t.push(`_limit=${e.page.limit}`)),e.search&&t.push(`q=${encodeURIComponent(e.search)}`),e.brokenratio&&t.push(`_brokenratio=${encodeURIComponent(e.brokenratio)}`),e.thumbhashratio&&t.push(`_thumbhashratio=${encodeURIComponent(e.thumbhashratio)}`),t.length>0?`?${t.join("&")}`:""}}const R=P,T={class:"w-full flex flex-col items-center gap-4"},U={class:"w-full grid grid-cols-[repeat(auto-fit,minmax(60px,1fr))] auto-rows-[60px] grid-flow-dense gap-4"},M=j({__name:"TestView",setup(n){const e=new R,t=c(1),o=c(null),s=c([]),r=()=>{t.value++,h()},h=async()=>{const a=await e.index({page:{number:t.value,limit:30}},"high");s.value=[...s.value,...a]},m=new IntersectionObserver(a=>{a.forEach(d=>{d.isIntersecting&&y()})},{root:null,rootMargin:"0px",threshold:.5}),y=()=>{console.log("El elemento estÃ¡ en el viewport"),r()};return $(async()=>{h().then(()=>m.observe(o.value))}),(a,d)=>(p(),l("div",T,[f("div",U,[(p(!0),l(_,null,C(s.value,(i,b)=>(p(),l("div",{key:b,class:x(["rounded-md border overflow-hidden",{"col-span-3 row-span-2":i.ratio==="landscape","row-span-3 col-span-2":i.ratio==="portrait","row-span-3 col-span-3":i.ratio==="square"&&Math.random()>.5}])},[I(w,{src:i.src,thumbHash:i.thumbhash,alt:i.ratio,class:"w-full h-full object-contain"},null,8,["src","thumbHash","alt"])],2))),128))]),f("div",{class:"w-full h-16 flex flex-col items-center justify-center",ref_key:"loadMoreEl",ref:o},null,512)]))}});export{M as default};
