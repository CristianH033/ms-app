import{d as ge,r as w,X as Se,l as H,Y as ee,Z as G,$ as De,a0 as Ee,a1 as he,a2 as Le,a3 as re,a4 as Ce,O as Oe,a5 as Re,q as Ae,a6 as Me,S as Ne,o as y,c as F,a,t as S,e as s,a7 as $e,F as z,i as Q,b as d,w as u,P as q,_ as M,U as ne,j as I,V as oe,M as j,W as qe,n as Ie,Q as Pe}from"./index-DzBWQBNt.js";import{S as ie}from"./ticket-line-duotone-DyTtdPwP.js";import{a as ue,b as ce,c as de,d as fe,S as ve,_ as pe}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-BxVJG7qs.js";import{_ as me,a as _e}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-DwLYGvUz.js";import{n as je}from"./strings-BzWVocVB.js";function we(l){var n;const e=G(l);return(n=e==null?void 0:e.$el)!=null?n:e}const Ue=Ce?window:void 0;function Z(...l){let n,e,o,_;if(typeof l[0]=="string"||Array.isArray(l[0])?([e,o,_]=l,n=Ue):[n,e,o,_]=l,!n)return De;Array.isArray(e)||(e=[e]),Array.isArray(o)||(o=[o]);const f=[],h=()=>{f.forEach(p=>p()),f.length=0},c=(p,b,T,m)=>(p.addEventListener(b,T,m),()=>p.removeEventListener(b,T,m)),x=ee(()=>[we(n),G(_)],([p,b])=>{if(h(),!p)return;const T=Ee(b)?{...b}:b;f.push(...e.flatMap(m=>o.map(D=>c(p,m,D,T))))},{immediate:!0,flush:"post"}),v=()=>{x(),h()};return he(v),v}const Ye=500,Be=10;function Ve(l,n,e){var o,_;const f=H(()=>we(l));let h,c,x,v=!1;function p(){h&&(clearTimeout(h),h=void 0),c=void 0,x=void 0,v=!1}function b(i){var E,L,C;const[O,N,U]=[x,c,v];if(p(),!(e!=null&&e.onMouseUp)||!N||!O||(E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value)return;(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation();const P=i.x-N.x,Y=i.y-N.y,W=Math.sqrt(P*P+Y*Y);e.onMouseUp(i.timeStamp-O,W,U)}function T(i){var E,L,C,O;(E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value||(p(),(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation(),c={x:i.x,y:i.y},x=i.timeStamp,h=setTimeout(()=>{v=!0,n(i)},(O=e==null?void 0:e.delay)!=null?O:Ye))}function m(i){var E,L,C,O;if((E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value||!c||(e==null?void 0:e.distanceThreshold)===!1)return;(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation();const N=i.x-c.x,U=i.y-c.y;Math.sqrt(N*N+U*U)>=((O=e==null?void 0:e.distanceThreshold)!=null?O:Be)&&p()}const D={capture:(o=e==null?void 0:e.modifiers)==null?void 0:o.capture,once:(_=e==null?void 0:e.modifiers)==null?void 0:_.once},V=[Z(f,"pointerdown",T,D),Z(f,"pointermove",m,D),Z(f,["pointerup","pointerleave"],b,D)];return()=>V.forEach(i=>i())}const We=ge({name:"OnLongPress",props:["as","options"],emits:["trigger"],setup(l,{slots:n,emit:e}){const o=w();return Ve(o,_=>{e("trigger",_)},l.options),()=>{if(n.default)return Se(l.as||"div",{ref:o},n.default())}}});function J(l){return typeof Window<"u"&&l instanceof Window?l.document.documentElement:typeof Document<"u"&&l instanceof Document?l.documentElement:l}function xe(l){const n=window.getComputedStyle(l);if(n.overflowX==="scroll"||n.overflowY==="scroll"||n.overflowX==="auto"&&l.clientWidth<l.scrollWidth||n.overflowY==="auto"&&l.clientHeight<l.scrollHeight)return!0;{const e=l.parentNode;return!e||e.tagName==="BODY"?!1:xe(e)}}function Fe(l){const n=l||window.event,e=n.target;return xe(e)?!1:n.touches.length>1?!0:(n.preventDefault&&n.preventDefault(),!1)}const K=new WeakMap;function He(l,n=!1){const e=w(n);let o=null,_="";ee(Le(l),c=>{const x=J(G(c));if(x){const v=x;if(K.get(v)||K.set(v,v.style.overflow),v.style.overflow!=="hidden"&&(_=v.style.overflow),v.style.overflow==="hidden")return e.value=!0;if(e.value)return v.style.overflow="hidden"}},{immediate:!0});const f=()=>{const c=J(G(l));!c||e.value||(re&&(o=Z(c,"touchmove",x=>{Fe(x)},{passive:!1})),c.style.overflow="hidden",e.value=!0)},h=()=>{const c=J(G(l));!c||!e.value||(re&&(o==null||o()),c.style.overflow=_,K.delete(c),e.value=!1)};return he(h),H({get(){return e.value},set(c){c?f():h()}})}function Ge(){let l=!1;const n=w(!1);return(e,o)=>{if(n.value=o.value,l)return;l=!0;const _=He(e,o.value);ee(n,f=>_.value=f)}}Ge();const Xe={class:"mx-auto rounded-md p-4"},Ze={class:"mb-4 flex items-center justify-between"},ze={class:"text-2xl font-bold uppercase text-primary"},Qe={class:"text-2xl font-bold uppercase"},Je={class:"max-w-80 text-right"},Ke={class:"capitalize"},et={class:"space-y-4 print:my-0"},tt={class:"flex flex-row items-center justify-center self-start tabular-nums print:self-center"},lt={class:"text-7xl text-primary print:text-7xl"},st={class:"flex flex-wrap gap-2"},at={class:"pointer-events-none"},rt={class:"flex w-full flex-col gap-4 print:flex-row"},nt={class:"flex w-full items-center gap-4 rounded-md border p-4 print:p-2"},ot=a("h3",{class:"text-3xl font-extrabold text-primary"},"POOL",-1),it={class:"flex flex-row flex-wrap gap-2"},ut={class:"flex justify-end"},ct={class:"flex flex-row items-center gap-4 rounded-md border p-4 text-right print:flex-col print:gap-2 print:p-2"},dt=a("p",{class:"text-lg font-semibold"},"TOTAL",-1),ft={class:"text-4xl font-extrabold text-primary"},vt={class:"flex flex-row items-center justify-start gap-2"},pt=a("span",null," Asignar Boletas ",-1),mt={class:"relative max-h-[55dvh] overflow-y-auto px-6 py-4"},_t={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},gt=a("span",null,"Asignar",-1),ht={class:"flex flex-row items-center justify-start gap-2"},wt=a("span",null," Remover Boleta ",-1),xt={class:"flex flex-row items-center justify-center gap-2 p-4"},bt=a("span",null,"Remover",-1),yt=a("header",{class:"hidden print:!fixed print:top-0 print:block"},"SÁNCHEZ INVERSIONES",-1),Lt=ge({__name:"SellerRaffleView",setup(l){const n=Oe(),e=Re(),o=n.currentRoute.value.params.id,_=n.currentRoute.value.params.seller_id,f=w(),h=w(),c=w(),x=w([]),v=w([]),p=w(null),b=w(!1),T=w(!1),m=w(!1),D=w(""),V=w(null),te=H(()=>{const t=Array.from(new Set(v.value.map(k=>k.number[0]))).map(k=>({group:k,sellerTickets:v.value.filter(R=>R.number[0]===k)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(k=>{const R=t.find(B=>B.group===k.group);return R==null||R.sellerTickets.sort((B,X)=>Number(B.number)-Number(X.number)),R||k})}),i=H(()=>v.value.length),E=H(()=>(console.log(D.value),D.value?x.value.filter(r=>r.number[0]===D.value):[])),L=r=>{D.value=r,Pe(()=>{b.value=!0})},C=r=>{var t,$;(t=p.value)!=null&&t.includes(r.id)?p.value=($=p.value)==null?void 0:$.filter(k=>k!==r.id):p.value=[...p.value??[],r.id]},O=r=>{var t;return(t=p.value)==null?void 0:t.includes(r.id)},N=async()=>{const{data:r,error:t}=await j.from("raffle_stats").select("*").eq("raffle_id",o).single();if(t)throw new Error(t.message);f.value=r},U=async()=>{const{data:r,error:t}=await j.from("sellers").select("*").eq("id",_).single();if(t)throw new Error(t.message);h.value=r},P=async()=>{const{data:r,error:t}=await j.from("tickets").select("*").eq("raffle_id",o).eq("seller_id",_);if(t)throw new Error(t.message);v.value=r},Y=async()=>{const{data:r,error:t}=await j.from("tickets").select("*").eq("raffle_id",o).is("seller_id",null);if(t)throw new Error(t.message);x.value=r},W=async()=>{const{data:r,error:t}=await j.from("raffles_sellers").select("*").eq("raffle_id",o).eq("seller_id",_).single();if(t)throw new Error(t.message);c.value=r},be=async()=>{var t;m.value=!0;const{error:r}=await j.from("tickets").update({seller_id:Number(_)}).in("id",(t=p.value)==null?void 0:t.map($=>Number($)));if(r)throw new Error(r.message);W(),Y(),P(),m.value=!1,b.value=!1},ye=async r=>{m.value=!0;const{error:t}=await j.from("tickets").update({seller_id:null}).eq("id",r);if(t)throw new Error(t.message);W(),Y(),P(),m.value=!1,T.value=!1},le=r=>{T.value=!0,V.value=r},ke=e.value;return Ae(async()=>{var r,t;await N(),await U(),await W(),await P(),await Y(),e.value=`${(t=(r=h.value)==null?void 0:r.name)==null?void 0:t.toUpperCase()} - SANCHEZ INVERSIONES`}),Me(()=>{e.value=ke}),(r,t)=>{var k,R,B,X,se,ae;const $=Ne("auto-animate");return y(),F("div",Xe,[a("div",Ze,[a("div",null,[a("h1",ze,S((k=f.value)==null?void 0:k.raffle_name),1),a("h2",Qe,S((R=h.value)==null?void 0:R.name),1),a("p",null,S((B=h.value)==null?void 0:B.phone),1)]),a("div",Je,[a("p",null,S(s(je)((X=c.value)==null?void 0:X.ticket_price)),1),a("p",null,S((se=f.value)==null?void 0:se.lottery_name),1),a("p",Ke,S(s($e)(new Date(Date.parse((ae=f.value)==null?void 0:ae.draw_drawn_at)),"dddd DD [de] MMMM [de] YYYY")),1)])]),a("div",et,[(y(!0),F(z,null,Q(te.value,g=>(y(),F("div",{key:g.group,class:"flex break-before-auto items-center gap-4 rounded-md border p-4 print:gap-1 print:p-2"},[a("div",tt,[a("h3",lt,S(g.group),1)]),a("div",st,[(y(!0),F(z,null,Q(g.sellerTickets,A=>(y(),I(s(We),{key:A.id,as:"button",class:"button small ml-2",onTrigger:Te=>le(A)},{default:u(()=>[d(s(M),{variant:"ghost",onContextmenu:qe(Te=>le(A),["prevent"]),class:"h-14 min-h-14 w-14 min-w-14 flex-col items-center justify-center rounded-full border border-primary text-lg print:h-10 print:min-h-10 print:w-10 print:min-w-10 print:rounded-md print:text-sm print:font-extrabold"},{default:u(()=>[a("span",at,S(A.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),d(s(M),{onClick:A=>L(g.group),variant:"ghost",class:"h-14 w-14 rounded-full border text-lg print:hidden"},{default:u(()=>[q(" + ")]),_:2},1032,["onClick"])])]))),128)),a("div",rt,[a("div",nt,[ot,a("div",it,[d(s(M),{variant:"ghost",class:"h-14 w-14 border text-lg print:hidden"},{default:u(()=>[q(" + ")]),_:1})])]),a("div",ut,[a("div",ct,[dt,a("p",ft,S(i.value),1)])])])]),d(s(pe),{open:b.value,"onUpdate:open":t[0]||(t[0]=g=>b.value=g)},{default:u(()=>[d(s(ue),{class:"max-h-[calc(100dvh-2rem)] w-[calc(100vw-2rem)] max-w-2xl grid-rows-[auto_minmax(0,1fr)_auto] gap-0 rounded-lg p-0 transition-[opacity,_transform]"},{default:u(()=>[d(s(ce),{class:"border-b p-6 pb-4"},{default:u(()=>[d(s(de),null,{default:u(()=>[a("div",vt,[d(s(ie),{class:"h-8 w-8"}),pt])]),_:1}),d(s(fe),null,{default:u(()=>[q(" Seleccione una o más boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),a("div",mt,[a("div",_t,[(y(!0),F(z,null,Q(E.value,g=>(y(),I(s(M),{key:g.id,variant:"ghost",class:Ie(["h-14 w-14 rounded-full border text-lg",{"bg-green-600 hover:bg-green-700":O(g)}]),onClick:A=>C(g),disabled:m.value},{default:u(()=>[q(S(g.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),d(s(me),{class:"gap-2 border-t p-6 pt-4"},{default:u(()=>[d(s(_e),{"as-child":""},{default:u(()=>[d(s(M),{variant:"secondary",type:"button",disabled:m.value},{default:u(()=>[q("Cancelar")]),_:1},8,["disabled"])]),_:1}),ne((y(),I(s(M),{onClick:be,class:"gap-3",form:"raffle-form",type:"submit",disabled:m.value},{default:u(()=>[m.value?(y(),I(s(oe),{key:0,class:"h-6 w-6"})):(y(),I(s(ve),{key:1,class:"h-6 w-6"})),gt]),_:1},8,["disabled"])),[[$]])]),_:1})]),_:1})]),_:1},8,["open"]),d(s(pe),{open:T.value,"onUpdate:open":t[2]||(t[2]=g=>T.value=g)},{default:u(()=>[d(s(ue),{class:"max-h-[calc(100dvh-2rem)] w-[calc(100vw-2rem)] max-w-2xl grid-rows-[auto_minmax(0,1fr)_auto] gap-0 rounded-lg p-0 transition-[opacity,_transform]"},{default:u(()=>[d(s(ce),{class:"border-b p-6 pb-4"},{default:u(()=>[d(s(de),null,{default:u(()=>[a("div",ht,[d(s(ie),{class:"h-8 w-8"}),wt])]),_:1}),d(s(fe),null,{default:u(()=>[q(" Esta acción removerá la boleta de este vendedor ")]),_:1})]),_:1}),a("div",xt,[d(s(M),{variant:"ghost",class:"h-32 w-32 rounded-full border text-4xl",disabled:m.value},{default:u(()=>{var g;return[q(S((g=V.value)==null?void 0:g.number),1)]}),_:1},8,["disabled"])]),d(s(me),{class:"gap-2 border-t p-6 pt-4"},{default:u(()=>[d(s(_e),{"as-child":""},{default:u(()=>[d(s(M),{variant:"secondary",type:"button",disabled:m.value},{default:u(()=>[q("Cancelar")]),_:1},8,["disabled"])]),_:1}),ne((y(),I(s(M),{onClick:t[1]||(t[1]=g=>{var A;return ye((A=V.value)==null?void 0:A.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:m.value},{default:u(()=>[m.value?(y(),I(s(oe),{key:0,class:"h-6 w-6"})):(y(),I(s(ve),{key:1,class:"h-6 w-6"})),bt]),_:1},8,["disabled"])),[[$]])]),_:1})]),_:1})]),_:1},8,["open"]),yt])}}});export{Lt as default};
