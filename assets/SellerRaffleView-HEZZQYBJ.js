import{d as ce,P as fe,r as d,l as P,p as pe,q as me,o as n,c as x,a as t,t as f,e as s,F as B,i as N,b as r,w as l,s as m,_ as c,W as U,v as M,j as v,S as z,V as h,n as _e,U as ve}from"./index-Cp5NQWbQ.js";import{S as W}from"./ticket-line-duotone-CQS9uz_z.js";import{S as H}from"./add-circle-line-duotone-Cf1MKQIB.js";import{_ as J,a as K,b as Q,c as X}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BdIJKHwI.js";import{_ as Y}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-WCL-aNPK.js";import{_ as Z,a as ee}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-DCA5IoPX.js";import{n as ge}from"./strings-BzWVocVB.js";import{O as he}from"./index-DtsEASZF.js";const be={class:"p-4 rounded-md mx-auto"},we={class:"flex justify-between items-center mb-4"},xe={class:"text-2xl font-bold"},ke={class:"text-xl uppercase"},ye={class:"text-right max-w-80"},Te={class:"space-y-4"},Se={class:"tabular-nums self-start"},Ce={class:"text-7xl"},$e={class:"flex flex-wrap gap-2"},qe={class:"pointer-events-none"},Re=t("div",{class:"w-full h-16"},null,-1),De=t("h3",{class:"text-xl break-before-page"},"Pulles",-1),Ee={class:"flex items-center gap-4 border p-4 rounded-md"},Ge={class:"flex gap-2"},je=t("span",{class:"pointer-events-none user-select-none"},"14",-1),Be={class:"flex flex-row gap-2 justify-start items-center"},Ne=t("span",null," Asignar Boletas ",-1),Ae={class:"px-6 py-4 overflow-y-auto relative max-h-[55dvh]"},Fe={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},Le=t("span",null,"Asignar",-1),Ve={class:"flex flex-row gap-2 justify-start items-center"},Ie=t("span",null," Remover Boleta ",-1),Oe={class:"flex flex-row gap-2 justify-center items-center p-4"},Pe=t("span",null,"Remover",-1),Ye=ce({__name:"SellerRaffleView",setup(Ue){const A=fe(),k=A.currentRoute.value.params.id,y=A.currentRoute.value.params.seller_id,$=d(),q=d(),F=d(),L=d([]),R=d([]),g=d(null),b=d(!1),T=d(!1),i=d(!1),S=d(""),D=d(null),se=P(()=>{const e=Array.from(new Set(R.value.map(u=>u.number[0]))).map(u=>({group:u,sellerTickets:R.value.filter(w=>w.number[0]===u)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(u=>e.find(C=>C.group===u.group)||u)}),ae=P(()=>(console.log(S.value),S.value?L.value.filter(a=>a.number[0]===S.value):[])),te=a=>{S.value=a,ve(()=>{b.value=!0})},le=a=>{var e,_;(e=g.value)!=null&&e.includes(a.id)?g.value=(_=g.value)==null?void 0:_.filter(u=>u!==a.id):g.value=[...g.value??[],a.id]},re=a=>{var e;return(e=g.value)==null?void 0:e.includes(a.id)},oe=async()=>{const{data:a,error:e}=await h.from("raffle_stats").select("*").eq("raffle_id",k).single();if(e)throw new Error(e.message);$.value=a},ne=async()=>{const{data:a,error:e}=await h.from("sellers").select("*").eq("id",y).single();if(e)throw new Error(e.message);q.value=a},E=async()=>{const{data:a,error:e}=await h.from("tickets").select("*").eq("raffle_id",k).eq("seller_id",y);if(e)throw new Error(e.message);R.value=a},G=async()=>{const{data:a,error:e}=await h.from("tickets").select("*").eq("raffle_id",k).is("seller_id",null);if(e)throw new Error(e.message);L.value=a},j=async()=>{const{data:a,error:e}=await h.from("raffles_sellers").select("*").eq("raffle_id",k).eq("seller_id",y).single();if(e)throw new Error(e.message);F.value=a},ie=async()=>{var e;i.value=!0;const{error:a}=await h.from("tickets").update({seller_id:Number(y)}).in("id",(e=g.value)==null?void 0:e.map(_=>Number(_)));if(a)throw new Error(a.message);j(),G(),E(),i.value=!1,b.value=!1},ue=async a=>{i.value=!0;const{error:e}=await h.from("tickets").update({seller_id:null}).eq("id",a);if(e)throw new Error(e.message);j(),G(),E(),i.value=!1,T.value=!1},V=a=>{T.value=!0,D.value=a};return pe(()=>{oe(),ne(),j(),E(),G()}),(a,e)=>{var u,w,C,I,O;const _=me("auto-animate");return n(),x("div",be,[t("div",we,[t("div",null,[t("h1",xe,f((u=$.value)==null?void 0:u.raffle_name),1),t("h2",ke,f((w=q.value)==null?void 0:w.name),1),t("p",null,f((C=q.value)==null?void 0:C.phone),1)]),t("div",ye,[t("p",null,f(s(ge)((I=F.value)==null?void 0:I.ticket_price)),1),t("p",null,f((O=$.value)==null?void 0:O.description),1)])]),t("div",Te,[(n(!0),x(B,null,N(se.value,o=>(n(),x("div",{key:o.group,class:"flex items-center gap-4 print:gap-1 border p-4 print:p-1 rounded-md break-before-auto"},[t("div",Se,[t("h3",Ce,f(o.group),1)]),t("div",$e,[(n(!0),x(B,null,N(o.sellerTickets,p=>(n(),v(s(he),{key:p.id,as:"button",class:"ml-2 button small",onTrigger:de=>V(p)},{default:l(()=>[r(s(c),{variant:"ghost",onContextmenu:U(de=>V(p),["prevent"]),class:"text-lg w-14 h-14 print:w-8 print:h-8 border rounded-full print:text-xs flex-col justify-center items-center"},{default:l(()=>[t("span",qe,f(p.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),r(s(c),{onClick:p=>te(o.group),variant:"ghost",class:"print:hidden text-lg w-14 h-14 border rounded-full"},{default:l(()=>[m(" + ")]),_:2},1032,["onClick"])])]))),128)),t("pre",null,f(b.value),1),Re,De,t("div",Ee,[t("div",Ge,[r(s(c),{class:"text-lg w-14 h-14 border bg-green-700 rounded-md"},{default:l(()=>[m(" 12 ")]),_:1}),r(s(c),{variant:"ghost",onContextmenu:e[0]||(e[0]=U(o=>b.value=!0,["prevent"])),class:"user-select-none text-lg w-14 h-14 border bg-green-700 rounded-md"},{default:l(()=>[je]),_:1}),r(s(c),{variant:"ghost",class:"print:hidden text-lg w-14 h-14 border"},{default:l(()=>[m(" + ")]),_:1})])])]),r(s(X),{open:b.value,"onUpdate:open":e[1]||(e[1]=o=>b.value=o)},{default:l(()=>[r(s(J),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(s(K),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(s(Q),null,{default:l(()=>[t("div",Be,[r(s(W),{class:"w-8 h-8"}),Ne])]),_:1}),r(s(Y),null,{default:l(()=>[m(" Seleccione una o más boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),t("div",Ae,[t("div",Fe,[(n(!0),x(B,null,N(ae.value,o=>(n(),v(s(c),{key:o.id,variant:"ghost",class:_e(["text-lg w-14 h-14 border rounded-full",{"bg-green-600 hover:bg-green-700":re(o)}]),onClick:p=>le(o),disabled:i.value},{default:l(()=>[m(f(o.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),r(s(Z),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(s(ee),{"as-child":""},{default:l(()=>[r(s(c),{variant:"secondary",type:"button",disabled:i.value},{default:l(()=>[m("Cancelar")]),_:1},8,["disabled"])]),_:1}),M((n(),v(s(c),{onClick:ie,class:"gap-3",form:"raffle-form",type:"submit",disabled:i.value},{default:l(()=>[i.value?(n(),v(s(z),{key:0,class:"h-6 w-6"})):(n(),v(s(H),{key:1,class:"w-6 h-6"})),Le]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"]),r(s(X),{open:T.value,"onUpdate:open":e[3]||(e[3]=o=>T.value=o)},{default:l(()=>[r(s(J),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(s(K),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(s(Q),null,{default:l(()=>[t("div",Ve,[r(s(W),{class:"w-8 h-8"}),Ie])]),_:1}),r(s(Y),null,{default:l(()=>[m(" Esta acción removerá la boleta de este vendedor ")]),_:1})]),_:1}),t("div",Oe,[r(s(c),{variant:"ghost",class:"text-4xl w-32 h-32 border rounded-full",disabled:i.value},{default:l(()=>{var o;return[m(f((o=D.value)==null?void 0:o.number),1)]}),_:1},8,["disabled"])]),r(s(Z),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(s(ee),{"as-child":""},{default:l(()=>[r(s(c),{variant:"secondary",type:"button",disabled:i.value},{default:l(()=>[m("Cancelar")]),_:1},8,["disabled"])]),_:1}),M((n(),v(s(c),{onClick:e[2]||(e[2]=o=>{var p;return ue((p=D.value)==null?void 0:p.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:i.value},{default:l(()=>[i.value?(n(),v(s(z),{key:0,class:"h-6 w-6"})):(n(),v(s(H),{key:1,class:"w-6 h-6"})),Pe]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"])])}}});export{Ye as default};
