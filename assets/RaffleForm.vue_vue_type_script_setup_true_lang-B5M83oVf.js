import{o as u,c as d,a as c,d as K,aj as ie,v as p,ak as ue,e,al as de,n as me,E as ce,am as L,an as fe,r as F,ao as _e,ap as pe,l as ve,p as he,q as ge,b as a,w as l,s as f,D as k,_ as T,Q as U,F as H,i as Z,y as be,z as we,W as ye,j as E,t as W,S as ke}from"./index-BFgALlmS.js";import{t as Se,z as _,u as xe,_ as h,a as g,b,c as w,F as y}from"./FormMessage.vue_vue_type_script_setup_true_lang-CEbTi8qU.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-BlxKCMPA.js";import{_ as ze,g as G}from"./DrawForm.vue_vue_type_script_setup_true_lang-yf1yRGA1.js";import{_ as Ve,a as $e,b as qe,c as Ee,d as Ce,e as Ne,f as De}from"./SelectScrollDownButton.vue_vue_type_script_setup_true_lang-C1VAzBRH.js";import{v as O,_ as Q,u as Fe}from"./storage-BlseGTyN.js";import{_ as X}from"./MoneyInput.vue_vue_type_script_setup_true_lang-Depmn9I5.js";import{S as R}from"./add-circle-line-duotone-C3R9Ln6S.js";import{S as Te}from"./cup-star-line-duotone-DzbyuxyS.js";import{c as Ue}from"./raffles-D9ND_7U9.js";import{c as Me,_ as Re,a as Pe,b as Ae}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-BP9nZPhK.js";import{_ as je}from"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-BbHl2fTq.js";const Be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ie=c("g",{fill:"none",stroke:"currentColor","stroke-width":"1.5"},[c("path",{d:"M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z",opacity:".5"}),c("path",{"stroke-linecap":"round",d:"m14.5 9.5l-5 5m0-5l5 5"})],-1),Le=[Ie];function He(x,$){return u(),d("svg",Be,[...Le])}const Ze={name:"solar-close-square-line-duotone",render:He},We=K({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(x,{emit:$}){const S=x,m=ie(S,"modelValue",$,{passive:!0,defaultValue:S.defaultValue});return(z,n)=>p((u(),d("textarea",{"onUpdate:modelValue":n[0]||(n[0]=q=>de(m)?m.value=q:null),class:me(e(ce)("flex min-h-20 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",S.class))},null,2)),[[ue,e(m)]])}}),Ge=["aria-disabled"],Oe=["disabled"],Qe={class:"flex flex-row gap-2"},Xe={key:0,class:"p-4",value:""},Ye={class:"grid gap-4 sm:grid-cols-2 sm:gap-6"},Je={class:"border col-span-2 rounded-md p-4 flex flex-col gap-4"},Ke={class:"text-lg font-medium flex gap-2"},ea=c("span",null,"Premios",-1),aa=["onClick"],la={class:"w-full border p-4 rounded-md"},sa={class:"text-lg font-medium"},ta={class:"w-full py-2 flex flex-row items-center justify-end"},oa=c("span",null,"Agregar premio",-1),na=c("span",null,"Crear",-1),Y=1,J=5e6,ba=K({__name:"RaffleForm",props:L({withoutActions:{type:[Boolean,String],default:!1}},{isSubmiting:{type:Boolean,required:!1,default:!1},isSubmitingModifiers:{}}),emits:L(["success"],["update:isSubmiting"]),setup(x,{emit:$}){const S=["image/jpeg","image/jpg","image/png","image/webp"],C=x,m=fe(x,"isSubmiting"),z=F([]),n=F({draw_id:void 0,name:"",description:"",image_path:null,thumb_hash:null,number_of_tickets:1e3,ticket_price:"",prizes:[{key:O().slice(-10),name:"",prize_value:"",image:null,thumb_hash:null}]}),q=_e(async()=>await G()),ee=pe(()=>{console.log("Clearing cache"),q.clear()},3e4),ae=Se(_.object({draw_id:_.string({required_error:"Sorteo es requerido"}).refine(async s=>{try{ee()}catch(t){console.error(t)}return await q().then(t=>t==null?void 0:t.some(o=>o.id.toString()===s))},{message:"El Sorteo no existe"}),name:_.string({required_error:"Nombre es requerido"}).min(3,{message:"Nombre debe tener al menos 3 caracteres"}),description:_.string({required_error:"La descripción es requerida"}).min(3,{message:"La descripción debe tener al menos 3 caracteres"}),number_of_tickets:_.number({required_error:"El numero de tickets es requerido"}).min(100,{message:"El numero de tickets debe ser mayor o igual a 100"}),ticket_price:_.string({required_error:"El valor es requerido"}).transform(s=>parseFloat(s)).refine(s=>!isNaN(s)&&s>=1,{message:"El valor debe ser un número mayor o igual a 1"}),prizes:_.array(_.object({name:_.string({required_error:"Nombre es requerido"}).min(3,{message:"Nombre debe tener al menos 3 caracteres"}),prize_value:_.string({required_error:"El valor es requerido"}).transform(s=>parseFloat(s)).refine(s=>!isNaN(s)&&s>=1,{message:"El valor debe ser un número mayor o igual a 1"}),image:_.instanceof(File).refine(s=>s instanceof File,{message:"Debe seleccionar una imagen"}).refine(s=>S.includes(s.type),{message:"Tipo de archivo no aceptado"}).refine(s=>s.size>=Y,{message:"El archivo está vacío"}).refine(s=>s.size<=J,{message:"El archivo es demasiado grande"})})).min(1),image:_.instanceof(File).refine(s=>s instanceof File,{message:"Debe seleccionar una imagen"}).refine(s=>S.includes(s.type),{message:"Tipo de archivo no aceptado"}).refine(s=>s.size>=Y,{message:"El archivo está vació"}).refine(s=>s.size<=J,{message:"El archivo es demasiado grande"})})),P=xe({validationSchema:ae,initialValues:{number_of_tickets:n.value.number_of_tickets}}),le=$,se=()=>{n.value.prizes.push({key:O().slice(-10),name:"",prize_value:"",image:null,thumb_hash:null})},te=s=>{n.value.prizes.length>1&&n.value.prizes.find(o=>o.key===s)&&(n.value.prizes=n.value.prizes.filter(o=>o.key!==s))},A=async s=>{const t=await Fe(s,s.name);return t==null?void 0:t.fullPath},oe=async s=>{const t=await{draw_id:parseInt(s.draw_id),name:s.name,description:s.description,image_path:await A(s.image),thumb_hash:n.value.thumb_hash,number_of_tickets:s.number_of_tickets,ticket_price:s.ticket_price,prizes:[]};return await s.prizes.forEach(async(o,r)=>{await A(o.image).then(i=>{t.prizes.push({name:o.name,prize_value:o.prize_value,thumb_hash:n.value.prizes[r].thumb_hash,image_path:i})})}),t},j=P.handleSubmit(async s=>{m.value=!0,P.setErrors({}),m.value=!1;const t=await oe(s);Ue(t).then(o=>{console.log(o),le("success")}).catch(o=>{console.log(o)}).finally(()=>{m.value=!1})},({errors:s})=>{const t=Object.keys(s)[0].replace("[",".").replace("]",""),o=document.querySelector(`[name="${t}"]`);o&&o.scrollIntoView({behavior:"smooth",block:"center"})}),ne=ve(()=>C.withoutActions===""||C.withoutActions===!0),N=F(!1),B=()=>{N.value=!1},re=async()=>{B(),await I()},I=async()=>{m.value=!0,await G().then(s=>z.value=s).finally(()=>m.value=!1),console.log(z.value)};return he(async()=>{await I()}),(s,t)=>{const o=ge("auto-animate");return u(),d("form",{onSubmit:t[7]||(t[7]=ye((...r)=>e(j)&&e(j)(...r),["prevent"])),class:"@container/form w-full flex flex-col gap-2","aria-disabled":m.value},[c("fieldset",{disabled:m.value},[a(e(y),{name:"name"},{default:l(({componentField:r})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Nombre")]),_:1}),a(e(b),null,{default:l(()=>[a(e(M),k({type:"text",placeholder:"Nombre de la Rifa"},r,{"model-value":n.value.name,"onUpdate:modelValue":t[0]||(t[0]=i=>n.value.name=i),required:""}),null,16,["model-value"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:1}),a(e(y),{name:"draw_id"},{default:l(({componentField:r})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Sorteo")]),_:1}),a(e(Ve),k(r,{"model-value":n.value.draw_id,"onUpdate:modelValue":t[2]||(t[2]=i=>n.value.draw_id=i)}),{default:l(()=>[a(e(b),null,{default:l(()=>[c("div",Qe,[a(e($e),null,{default:l(()=>[a(e(qe),{placeholder:"Elige un sorteo"})]),_:1}),a(e(Me),{open:N.value,"onUpdate:open":t[1]||(t[1]=i=>N.value=i)},{default:l(()=>[a(e(je),{"as-child":""},{default:l(()=>[a(e(T),{variant:"outline",type:"button"},{default:l(()=>[a(e(R),{class:"w-6 h-6"})]),_:1})]),_:1}),a(e(Re),null,{default:l(()=>[a(e(Pe),null,{default:l(()=>[a(e(Ae),null,{default:l(()=>[f("Crear nuevo sorteo")]),_:1}),a(ze,{onSuccess:re,onCancel:B})]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),a(e(Ee),null,{default:l(()=>[a(e(Ce),null,{default:l(()=>[a(e(Ne),null,{default:l(()=>[f("Sorteos")]),_:1}),z.value.length===0?(u(),d("div",Xe,"No hay sorteos")):U("",!0),(u(!0),d(H,null,Z(z.value,i=>(u(),E(e(De),{key:i.id,value:i.id.toString()},{default:l(()=>[f(W(i.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:2},1040,["model-value"]),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:1}),a(e(y),{name:"description"},{default:l(({componentField:r})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Descripción")]),_:1}),a(e(b),null,{default:l(()=>[a(e(We),k({type:"text",placeholder:"Descripción de la Rifa"},r,{"model-value":n.value.description,"onUpdate:modelValue":t[3]||(t[3]=i=>n.value.description=i),required:""}),null,16,["model-value"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:1}),a(e(y),{name:"number_of_tickets"},{default:l(({componentField:r})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Número de Bonos:")]),_:1}),a(e(b),null,{default:l(()=>[a(e(M),k({type:"number",inputmode:"numeric",placeholder:"Nombre de la Rifa"},r,{"model-value":n.value.number_of_tickets,"onUpdate:modelValue":t[4]||(t[4]=i=>n.value.number_of_tickets=i),required:""}),null,16,["model-value"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:1}),a(e(y),{name:"ticket_price"},{default:l(({value:r,handleChange:i})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Costo del Bono")]),_:1}),a(e(b),null,{default:l(()=>[a(X,{"model-value":r,"onUpdate:modelValue":[v=>i(v,!0),t[5]||(t[5]=v=>n.value.ticket_price=v)],modelValue:n.value.ticket_price,required:""},null,8,["model-value","onUpdate:modelValue","modelValue"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:1}),a(e(y),{name:"image"},{default:l(({componentField:r})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Portada de la rifa")]),_:1}),a(e(b),null,{default:l(()=>[a(Q,k(r,{base64ThumbHash:n.value.thumb_hash,"onUpdate:base64ThumbHash":t[6]||(t[6]=i=>n.value.thumb_hash=i)}),null,16,["base64ThumbHash"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:1}),c("div",Ye,[p((u(),d("fieldset",Je,[c("legend",Ke,[a(e(Te),{class:"w-8 h-8"}),ea]),(u(!0),d(H,null,Z(n.value.prizes,(r,i)=>(u(),d("div",{class:"w-full relative",key:r.key},[n.value.prizes.length>1?(u(),d("button",{key:0,type:"button",class:"bg-background rounded-xl absolute right-0 top-0",onClick:v=>te(r.key)},[a(e(Ze),{class:"w-8 h-8"})],8,aa)):U("",!0),c("fieldset",la,[c("legend",sa,"Premio "+W(i+1),1),a(e(y),{name:"prizes."+i+".name"},{default:l(({componentField:v})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Nombre")]),_:1}),a(e(b),null,{default:l(()=>[a(e(M),k({type:"text",placeholder:"Nombre del premio",ref_for:!0},v,{"model-value":r.name,"onUpdate:modelValue":V=>r.name=V,required:""}),null,16,["model-value","onUpdate:modelValue"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:2},1032,["name"]),a(e(y),{name:"prizes."+i+".prize_value"},{default:l(({value:v,handleChange:V})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Valor del premio")]),_:1}),a(e(b),null,{default:l(()=>[a(X,{"model-value":v,"onUpdate:modelValue":[D=>V(D,!0),D=>r.prize_value=D],modelValue:r.prize_value,required:""},null,8,["model-value","onUpdate:modelValue","modelValue"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:2},1032,["name"]),a(e(y),{name:"prizes."+i+".image"},{default:l(({componentField:v})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Imagen")]),_:1}),a(e(b),null,{default:l(()=>[a(Q,k({ref_for:!0},v,{base64ThumbHash:r.thumb_hash,"onUpdate:base64ThumbHash":V=>r.thumb_hash=V}),null,16,["base64ThumbHash","onUpdate:base64ThumbHash"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[o]])]),_:2},1024)]),_:2},1032,["name"])])]))),128)),c("div",ta,[a(e(T),{variant:"outline",type:"button",class:"w-full gap-2 @xl/form:w-auto",onClick:se},{default:l(()=>[a(e(R),{class:"w-6 h-6"}),oa]),_:1})])])),[[o]])]),ne.value?U("",!0):be(s.$slots,"actions",we(k({key:0},{isSubmiting:m.value})),()=>[a(e(h),{class:"w-full py-2 flex flex-row items-center justify-end"},{default:l(()=>[p((u(),E(e(T),{type:"submit",class:"w-full gap-2 @xl/form:w-auto"},{default:l(()=>[m.value?(u(),E(e(ke),{key:0,class:"h-6 w-6"})):(u(),E(e(R),{key:1,class:"w-6 h-6"})),na]),_:1})),[[o]])]),_:1})])],8,Oe)],40,Ge)}}});export{ba as _};
