import{d as _e,r as x,W as Se,l as H,X as ee,Z as G,$ as De,a0 as Ee,a1 as we,a2 as Le,a3 as ae,a4 as Ce,N as Oe,a5 as Ne,q as Re,a6 as Ae,Q as $e,o as h,c as F,a as s,t as S,e as r,a7 as Me,F as z,i as Q,b as c,w as u,O as q,_ as A,S as ne,j as I,U as oe,L as j,V as qe,n as Ie,P as Pe}from"./index-B4iZ3EM6.js";import{S as ie}from"./ticket-line-duotone-DV8mwnlN.js";import{a as ue,b as de,c as ce,d as fe,S as ve,_ as pe}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-ChD8eHFR.js";import{_ as me,a as ge}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-BMx5v9oj.js";import{n as je}from"./strings-BzWVocVB.js";const Ue=Ce?window:void 0;function xe(l){var n;const e=G(l);return(n=e==null?void 0:e.$el)!=null?n:e}function Z(...l){let n,e,o,g;if(typeof l[0]=="string"||Array.isArray(l[0])?([e,o,g]=l,n=Ue):[n,e,o,g]=l,!n)return De;Array.isArray(e)||(e=[e]),Array.isArray(o)||(o=[o]);const f=[],w=()=>{f.forEach(p=>p()),f.length=0},d=(p,y,T,m)=>(p.addEventListener(y,T,m),()=>p.removeEventListener(y,T,m)),b=ee(()=>[xe(n),G(g)],([p,y])=>{if(w(),!p)return;const T=Ee(y)?{...y}:y;f.push(...e.flatMap(m=>o.map(D=>d(p,m,D,T))))},{immediate:!0,flush:"post"}),v=()=>{b(),w()};return we(v),v}const Be=500,Ve=10;function We(l,n,e){var o,g;const f=H(()=>xe(l));let w,d,b,v=!1;function p(){w&&(clearTimeout(w),w=void 0),d=void 0,b=void 0,v=!1}function y(i){var E,L,C;const[O,$,U]=[b,d,v];if(p(),!(e!=null&&e.onMouseUp)||!$||!O||(E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value)return;(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation();const P=i.x-$.x,B=i.y-$.y,Y=Math.sqrt(P*P+B*B);e.onMouseUp(i.timeStamp-O,Y,U)}function T(i){var E,L,C,O;(E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value||(p(),(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation(),d={x:i.x,y:i.y},b=i.timeStamp,w=setTimeout(()=>{v=!0,n(i)},(O=e==null?void 0:e.delay)!=null?O:Be))}function m(i){var E,L,C,O;if((E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value||!d||(e==null?void 0:e.distanceThreshold)===!1)return;(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation();const $=i.x-d.x,U=i.y-d.y;Math.sqrt($*$+U*U)>=((O=e==null?void 0:e.distanceThreshold)!=null?O:Ve)&&p()}const D={capture:(o=e==null?void 0:e.modifiers)==null?void 0:o.capture,once:(g=e==null?void 0:e.modifiers)==null?void 0:g.once},W=[Z(f,"pointerdown",T,D),Z(f,"pointermove",m,D),Z(f,["pointerup","pointerleave"],y,D)];return()=>W.forEach(i=>i())}const Ye=_e({name:"OnLongPress",props:["as","options"],emits:["trigger"],setup(l,{slots:n,emit:e}){const o=x();return We(o,g=>{e("trigger",g)},l.options),()=>{if(n.default)return Se(l.as||"div",{ref:o},n.default())}}});function J(l){return typeof Window<"u"&&l instanceof Window?l.document.documentElement:typeof Document<"u"&&l instanceof Document?l.documentElement:l}function be(l){const n=window.getComputedStyle(l);if(n.overflowX==="scroll"||n.overflowY==="scroll"||n.overflowX==="auto"&&l.clientWidth<l.scrollWidth||n.overflowY==="auto"&&l.clientHeight<l.scrollHeight)return!0;{const e=l.parentNode;return!e||e.tagName==="BODY"?!1:be(e)}}function Fe(l){const n=l||window.event,e=n.target;return be(e)?!1:n.touches.length>1?!0:(n.preventDefault&&n.preventDefault(),!1)}const K=new WeakMap;function He(l,n=!1){const e=x(n);let o=null,g="";ee(Le(l),d=>{const b=J(G(d));if(b){const v=b;if(K.get(v)||K.set(v,v.style.overflow),v.style.overflow!=="hidden"&&(g=v.style.overflow),v.style.overflow==="hidden")return e.value=!0;if(e.value)return v.style.overflow="hidden"}},{immediate:!0});const f=()=>{const d=J(G(l));!d||e.value||(ae&&(o=Z(d,"touchmove",b=>{Fe(b)},{passive:!1})),d.style.overflow="hidden",e.value=!0)},w=()=>{const d=J(G(l));!d||!e.value||(ae&&(o==null||o()),d.style.overflow=g,K.delete(d),e.value=!1)};return we(w),H({get(){return e.value},set(d){d?f():w()}})}function Ge(){let l=!1;const n=x(!1);return(e,o)=>{if(n.value=o.value,l)return;l=!0;const g=He(e,o.value);ee(n,f=>g.value=f)}}Ge();const Xe={class:"mx-auto rounded-md p-4"},Ze={class:"mb-4 flex items-center justify-between"},ze={class:"text-2xl font-bold uppercase text-primary"},Qe={class:"text-2xl font-bold uppercase"},Je={class:"max-w-80 text-right"},Ke={class:"capitalize"},et={class:"space-y-4 print:my-0"},tt={class:"flex flex-row items-center justify-center self-start tabular-nums print:self-center"},lt={class:"text-7xl text-primary print:text-7xl"},st={class:"flex flex-wrap gap-2"},rt={class:"pointer-events-none"},at={class:"flex w-full flex-col gap-4 print:flex-row"},nt={class:"flex w-full items-center gap-4 rounded-md border p-4 print:p-2"},ot={class:"flex flex-row flex-wrap gap-2"},it={class:"flex justify-end"},ut={class:"flex flex-row items-center gap-4 rounded-md border p-4 text-right print:flex-col print:gap-2 print:p-2"},dt={class:"text-4xl font-extrabold text-primary"},ct={class:"flex flex-row items-center justify-start gap-2"},ft={class:"relative max-h-[55dvh] overflow-y-auto px-6 py-4"},vt={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},pt={class:"flex flex-row items-center justify-start gap-2"},mt={class:"flex flex-row items-center justify-center gap-2 p-4"},yt=_e({__name:"SellerRaffleView",setup(l){const n=Oe(),e=Ne(),o=n.currentRoute.value.params.id,g=n.currentRoute.value.params.seller_id,f=x(),w=x(),d=x(),b=x([]),v=x([]),p=x(null),y=x(!1),T=x(!1),m=x(!1),D=x(""),W=x(null),te=H(()=>{const t=Array.from(new Set(v.value.map(k=>k.number[0]))).map(k=>({group:k,sellerTickets:v.value.filter(N=>N.number[0]===k)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(k=>{const N=t.find(V=>V.group===k.group);return N==null||N.sellerTickets.sort((V,X)=>Number(V.number)-Number(X.number)),N||k})}),i=H(()=>v.value.length),E=H(()=>(console.log(D.value),D.value?b.value.filter(a=>a.number[0]===D.value):[])),L=a=>{D.value=a,Pe(()=>{y.value=!0})},C=a=>{var t,M;(t=p.value)!=null&&t.includes(a.id)?p.value=(M=p.value)==null?void 0:M.filter(k=>k!==a.id):p.value=[...p.value??[],a.id]},O=a=>{var t;return(t=p.value)==null?void 0:t.includes(a.id)},$=async()=>{const{data:a,error:t}=await j.from("raffle_stats").select("*").eq("raffle_id",o).single();if(t)throw new Error(t.message);f.value=a},U=async()=>{const{data:a,error:t}=await j.from("sellers").select("*").eq("id",g).single();if(t)throw new Error(t.message);w.value=a},P=async()=>{const{data:a,error:t}=await j.from("tickets").select("*").eq("raffle_id",o).eq("seller_id",g);if(t)throw new Error(t.message);v.value=a},B=async()=>{const{data:a,error:t}=await j.from("tickets").select("*").eq("raffle_id",o).is("seller_id",null);if(t)throw new Error(t.message);b.value=a},Y=async()=>{const{data:a,error:t}=await j.from("raffles_sellers").select("*").eq("raffle_id",o).eq("seller_id",g).single();if(t)throw new Error(t.message);d.value=a},ye=async()=>{var t;m.value=!0;const{error:a}=await j.from("tickets").update({seller_id:Number(g)}).in("id",(t=p.value)==null?void 0:t.map(M=>Number(M)));if(a)throw new Error(a.message);Y(),B(),P(),m.value=!1,y.value=!1},he=async a=>{m.value=!0;const{error:t}=await j.from("tickets").update({seller_id:null}).eq("id",a);if(t)throw new Error(t.message);Y(),B(),P(),m.value=!1,T.value=!1},le=a=>{T.value=!0,W.value=a},ke=e.value;return Re(async()=>{var a,t;await $(),await U(),await Y(),await P(),await B(),e.value=`${(t=(a=w.value)==null?void 0:a.name)==null?void 0:t.toUpperCase()} - SANCHEZ INVERSIONES`}),Ae(()=>{e.value=ke}),(a,t)=>{var k,N,V,X,se,re;const M=$e("auto-animate");return h(),F("div",Xe,[s("div",Ze,[s("div",null,[s("h1",ze,S((k=f.value)==null?void 0:k.raffle_name),1),s("h2",Qe,S((N=w.value)==null?void 0:N.name),1),s("p",null,S((V=w.value)==null?void 0:V.phone),1)]),s("div",Je,[s("p",null,S(r(je)((X=d.value)==null?void 0:X.ticket_price)),1),s("p",null,S((se=f.value)==null?void 0:se.lottery_name),1),s("p",Ke,S(r(Me)(new Date(Date.parse((re=f.value)==null?void 0:re.draw_drawn_at)),"dddd DD [de] MMMM [de] YYYY")),1)])]),s("div",et,[(h(!0),F(z,null,Q(te.value,_=>(h(),F("div",{key:_.group,class:"flex break-before-auto items-center gap-4 rounded-md border p-4 print:gap-1 print:p-2"},[s("div",tt,[s("h3",lt,S(_.group),1)]),s("div",st,[(h(!0),F(z,null,Q(_.sellerTickets,R=>(h(),I(r(Ye),{key:R.id,as:"button",class:"button small ml-2",onTrigger:Te=>le(R)},{default:u(()=>[c(r(A),{variant:"ghost",onContextmenu:qe(Te=>le(R),["prevent"]),class:"h-14 min-h-14 w-14 min-w-14 flex-col items-center justify-center rounded-full border border-primary text-lg print:h-10 print:min-h-10 print:w-10 print:min-w-10 print:rounded-md print:text-sm print:font-extrabold"},{default:u(()=>[s("span",rt,S(R.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),c(r(A),{onClick:R=>L(_.group),variant:"ghost",class:"h-14 w-14 rounded-full border text-lg print:hidden"},{default:u(()=>t[3]||(t[3]=[q(" + ")])),_:2},1032,["onClick"])])]))),128)),s("div",at,[s("div",nt,[t[5]||(t[5]=s("h3",{class:"text-3xl font-extrabold text-primary"},"POOL",-1)),s("div",ot,[c(r(A),{variant:"ghost",class:"h-14 w-14 border text-lg print:hidden"},{default:u(()=>t[4]||(t[4]=[q(" + ")])),_:1})])]),s("div",it,[s("div",ut,[t[6]||(t[6]=s("p",{class:"text-lg font-semibold"},"TOTAL",-1)),s("p",dt,S(i.value),1)])])])]),c(r(pe),{open:y.value,"onUpdate:open":t[0]||(t[0]=_=>y.value=_)},{default:u(()=>[c(r(ue),{class:"max-h-[calc(100dvh-2rem)] w-[calc(100vw-2rem)] max-w-2xl grid-rows-[auto_minmax(0,1fr)_auto] gap-0 rounded-lg p-0 transition-[opacity,_transform]"},{default:u(()=>[c(r(de),{class:"border-b p-6 pb-4"},{default:u(()=>[c(r(ce),null,{default:u(()=>[s("div",ct,[c(r(ie),{class:"h-8 w-8"}),t[7]||(t[7]=s("span",null," Asignar Boletas ",-1))])]),_:1}),c(r(fe),null,{default:u(()=>t[8]||(t[8]=[q(" Seleccione una o más boletas para asignarlas a este vendedor ")])),_:1})]),_:1}),s("div",ft,[s("div",vt,[(h(!0),F(z,null,Q(E.value,_=>(h(),I(r(A),{key:_.id,variant:"ghost",class:Ie(["h-14 w-14 rounded-full border text-lg",{"bg-green-600 hover:bg-green-700":O(_)}]),onClick:R=>C(_),disabled:m.value},{default:u(()=>[q(S(_.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),c(r(me),{class:"gap-2 border-t p-6 pt-4"},{default:u(()=>[c(r(ge),{"as-child":""},{default:u(()=>[c(r(A),{variant:"secondary",type:"button",disabled:m.value},{default:u(()=>t[9]||(t[9]=[q("Cancelar")])),_:1},8,["disabled"])]),_:1}),ne((h(),I(r(A),{onClick:ye,class:"gap-3",form:"raffle-form",type:"submit",disabled:m.value},{default:u(()=>[m.value?(h(),I(r(oe),{key:0,class:"h-6 w-6"})):(h(),I(r(ve),{key:1,class:"h-6 w-6"})),t[10]||(t[10]=s("span",null,"Asignar",-1))]),_:1},8,["disabled"])),[[M]])]),_:1})]),_:1})]),_:1},8,["open"]),c(r(pe),{open:T.value,"onUpdate:open":t[2]||(t[2]=_=>T.value=_)},{default:u(()=>[c(r(ue),{class:"max-h-[calc(100dvh-2rem)] w-[calc(100vw-2rem)] max-w-2xl grid-rows-[auto_minmax(0,1fr)_auto] gap-0 rounded-lg p-0 transition-[opacity,_transform]"},{default:u(()=>[c(r(de),{class:"border-b p-6 pb-4"},{default:u(()=>[c(r(ce),null,{default:u(()=>[s("div",pt,[c(r(ie),{class:"h-8 w-8"}),t[11]||(t[11]=s("span",null," Remover Boleta ",-1))])]),_:1}),c(r(fe),null,{default:u(()=>t[12]||(t[12]=[q(" Esta acción removerá la boleta de este vendedor ")])),_:1})]),_:1}),s("div",mt,[c(r(A),{variant:"ghost",class:"h-32 w-32 rounded-full border text-4xl",disabled:m.value},{default:u(()=>{var _;return[q(S((_=W.value)==null?void 0:_.number),1)]}),_:1},8,["disabled"])]),c(r(me),{class:"gap-2 border-t p-6 pt-4"},{default:u(()=>[c(r(ge),{"as-child":""},{default:u(()=>[c(r(A),{variant:"secondary",type:"button",disabled:m.value},{default:u(()=>t[13]||(t[13]=[q("Cancelar")])),_:1},8,["disabled"])]),_:1}),ne((h(),I(r(A),{onClick:t[1]||(t[1]=_=>{var R;return he((R=W.value)==null?void 0:R.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:m.value},{default:u(()=>[m.value?(h(),I(r(oe),{key:0,class:"h-6 w-6"})):(h(),I(r(ve),{key:1,class:"h-6 w-6"})),t[14]||(t[14]=s("span",null,"Remover",-1))]),_:1},8,["disabled"])),[[M]])]),_:1})]),_:1})]),_:1},8,["open"]),t[15]||(t[15]=s("header",{class:"hidden print:!fixed print:top-0 print:block"},"SÁNCHEZ INVERSIONES",-1))])}}});export{yt as default};
