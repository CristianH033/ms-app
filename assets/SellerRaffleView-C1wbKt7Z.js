import{d as ge,r as w,aC as Se,y as W,Z as ee,aD as G,aE as De,aF as Ee,aG as he,aH as Le,aI as re,aJ as Ce,am as Oe,aK as Re,a0 as Ae,aL as Me,a1 as Ne,o as y,c as V,a,t as S,e as s,aM as $e,F as X,i as J,b as d,w as u,B as q,_ as M,q as ne,j as I,a5 as oe,s as B,a6 as qe,n as Ie,an as je}from"./index-8-8s4u9f.js";import{S as ie}from"./ticket-line-duotone-CV830B2w.js";import{a as ue,b as ce,c as de,d as fe,S as ve,_ as pe}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-CuwI5Iah.js";import{_ as me,a as _e}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-OjRlr1Zq.js";import{n as Be}from"./strings-BzWVocVB.js";function we(l){var n;const e=G(l);return(n=e==null?void 0:e.$el)!=null?n:e}const Pe=Ce?window:void 0;function z(...l){let n,e,o,_;if(typeof l[0]=="string"||Array.isArray(l[0])?([e,o,_]=l,n=Pe):[n,e,o,_]=l,!n)return De;Array.isArray(e)||(e=[e]),Array.isArray(o)||(o=[o]);const f=[],h=()=>{f.forEach(p=>p()),f.length=0},c=(p,b,T,m)=>(p.addEventListener(b,T,m),()=>p.removeEventListener(b,T,m)),x=ee(()=>[we(n),G(_)],([p,b])=>{if(h(),!p)return;const T=Ee(b)?{...b}:b;f.push(...e.flatMap(m=>o.map(D=>c(p,m,D,T))))},{immediate:!0,flush:"post"}),v=()=>{x(),h()};return he(v),v}const Fe=500,Ue=10;function Ye(l,n,e){var o,_;const f=W(()=>we(l));let h,c,x,v=!1;function p(){h&&(clearTimeout(h),h=void 0),c=void 0,x=void 0,v=!1}function b(i){var E,L,C;const[O,N,P]=[x,c,v];if(p(),!(e!=null&&e.onMouseUp)||!N||!O||(E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value)return;(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation();const j=i.x-N.x,F=i.y-N.y,H=Math.sqrt(j*j+F*F);e.onMouseUp(i.timeStamp-O,H,P)}function T(i){var E,L,C,O;(E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value||(p(),(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation(),c={x:i.x,y:i.y},x=i.timeStamp,h=setTimeout(()=>{v=!0,n(i)},(O=e==null?void 0:e.delay)!=null?O:Fe))}function m(i){var E,L,C,O;if((E=e==null?void 0:e.modifiers)!=null&&E.self&&i.target!==f.value||!c||(e==null?void 0:e.distanceThreshold)===!1)return;(L=e==null?void 0:e.modifiers)!=null&&L.prevent&&i.preventDefault(),(C=e==null?void 0:e.modifiers)!=null&&C.stop&&i.stopPropagation();const N=i.x-c.x,P=i.y-c.y;Math.sqrt(N*N+P*P)>=((O=e==null?void 0:e.distanceThreshold)!=null?O:Ue)&&p()}const D={capture:(o=e==null?void 0:e.modifiers)==null?void 0:o.capture,once:(_=e==null?void 0:e.modifiers)==null?void 0:_.once},Y=[z(f,"pointerdown",T,D),z(f,"pointermove",m,D),z(f,["pointerup","pointerleave"],b,D)];return()=>Y.forEach(i=>i())}const He=ge({name:"OnLongPress",props:["as","options"],emits:["trigger"],setup(l,{slots:n,emit:e}){const o=w();return Ye(o,_=>{e("trigger",_)},l.options),()=>{if(n.default)return Se(l.as||"div",{ref:o},n.default())}}});function K(l){return typeof Window<"u"&&l instanceof Window?l.document.documentElement:typeof Document<"u"&&l instanceof Document?l.documentElement:l}function xe(l){const n=window.getComputedStyle(l);if(n.overflowX==="scroll"||n.overflowY==="scroll"||n.overflowX==="auto"&&l.clientWidth<l.scrollWidth||n.overflowY==="auto"&&l.clientHeight<l.scrollHeight)return!0;{const e=l.parentNode;return!e||e.tagName==="BODY"?!1:xe(e)}}function Ve(l){const n=l||window.event,e=n.target;return xe(e)?!1:n.touches.length>1?!0:(n.preventDefault&&n.preventDefault(),!1)}const Q=new WeakMap;function We(l,n=!1){const e=w(n);let o=null,_="";ee(Le(l),c=>{const x=K(G(c));if(x){const v=x;if(Q.get(v)||Q.set(v,v.style.overflow),v.style.overflow!=="hidden"&&(_=v.style.overflow),v.style.overflow==="hidden")return e.value=!0;if(e.value)return v.style.overflow="hidden"}},{immediate:!0});const f=()=>{const c=K(G(l));!c||e.value||(re&&(o=z(c,"touchmove",x=>{Ve(x)},{passive:!1})),c.style.overflow="hidden",e.value=!0)},h=()=>{const c=K(G(l));!c||!e.value||(re&&(o==null||o()),c.style.overflow=_,Q.delete(c),e.value=!1)};return he(h),W({get(){return e.value},set(c){c?f():h()}})}function Ge(){let l=!1;const n=w(!1);return(e,o)=>{if(n.value=o.value,l)return;l=!0;const _=We(e,o.value);ee(n,f=>_.value=f)}}Ge();const Ze={class:"p-4 rounded-md mx-auto"},ze={class:"flex justify-between items-center mb-4"},Xe={class:"text-primary text-2xl font-bold uppercase"},Je={class:"text-2xl font-bold uppercase"},Ke={class:"text-right max-w-80"},Qe={class:"capitalize"},et={class:"space-y-4 print:my-0"},tt={class:"tabular-nums flex flex-row justify-center items-center self-start print:self-center"},lt={class:"text-7xl text-primary print:text-7xl"},st={class:"flex flex-wrap gap-2"},at={class:"pointer-events-none"},rt={class:"w-full flex flex-col print:flex-row gap-4"},nt={class:"w-full flex items-center gap-4 border p-4 print:p-2 rounded-md"},ot=a("h3",{class:"font-extrabold text-3xl text-primary"},"POOL",-1),it={class:"flex flex-row flex-wrap gap-2"},ut={class:"flex justify-end"},ct={class:"flex flex-row print:flex-col items-center border rounded-md p-4 print:p-2 gap-4 print:gap-2 text-right"},dt=a("p",{class:"font-semibold text-lg"},"TOTAL",-1),ft={class:"text-4xl font-extrabold text-primary"},vt={class:"flex flex-row gap-2 justify-start items-center"},pt=a("span",null," Asignar Boletas ",-1),mt={class:"px-6 py-4 overflow-y-auto relative max-h-[55dvh]"},_t={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},gt=a("span",null,"Asignar",-1),ht={class:"flex flex-row gap-2 justify-start items-center"},wt=a("span",null," Remover Boleta ",-1),xt={class:"flex flex-row gap-2 justify-center items-center p-4"},bt=a("span",null,"Remover",-1),yt=a("header",{class:"hidden print:block print:!fixed print:top-0"},"SÁNCHEZ INVERSIONES",-1),Lt=ge({__name:"SellerRaffleView",setup(l){const n=Oe(),e=Re(),o=n.currentRoute.value.params.id,_=n.currentRoute.value.params.seller_id,f=w(),h=w(),c=w(),x=w([]),v=w([]),p=w(null),b=w(!1),T=w(!1),m=w(!1),D=w(""),Y=w(null),te=W(()=>{const t=Array.from(new Set(v.value.map(k=>k.number[0]))).map(k=>({group:k,sellerTickets:v.value.filter(R=>R.number[0]===k)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(k=>{const R=t.find(U=>U.group===k.group);return R==null||R.sellerTickets.sort((U,Z)=>Number(U.number)-Number(Z.number)),R||k})}),i=W(()=>v.value.length),E=W(()=>(console.log(D.value),D.value?x.value.filter(r=>r.number[0]===D.value):[])),L=r=>{D.value=r,je(()=>{b.value=!0})},C=r=>{var t,$;(t=p.value)!=null&&t.includes(r.id)?p.value=($=p.value)==null?void 0:$.filter(k=>k!==r.id):p.value=[...p.value??[],r.id]},O=r=>{var t;return(t=p.value)==null?void 0:t.includes(r.id)},N=async()=>{const{data:r,error:t}=await B.from("raffle_stats").select("*").eq("raffle_id",o).single();if(t)throw new Error(t.message);f.value=r},P=async()=>{const{data:r,error:t}=await B.from("sellers").select("*").eq("id",_).single();if(t)throw new Error(t.message);h.value=r},j=async()=>{const{data:r,error:t}=await B.from("tickets").select("*").eq("raffle_id",o).eq("seller_id",_);if(t)throw new Error(t.message);v.value=r},F=async()=>{const{data:r,error:t}=await B.from("tickets").select("*").eq("raffle_id",o).is("seller_id",null);if(t)throw new Error(t.message);x.value=r},H=async()=>{const{data:r,error:t}=await B.from("raffles_sellers").select("*").eq("raffle_id",o).eq("seller_id",_).single();if(t)throw new Error(t.message);c.value=r},be=async()=>{var t;m.value=!0;const{error:r}=await B.from("tickets").update({seller_id:Number(_)}).in("id",(t=p.value)==null?void 0:t.map($=>Number($)));if(r)throw new Error(r.message);H(),F(),j(),m.value=!1,b.value=!1},ye=async r=>{m.value=!0;const{error:t}=await B.from("tickets").update({seller_id:null}).eq("id",r);if(t)throw new Error(t.message);H(),F(),j(),m.value=!1,T.value=!1},le=r=>{T.value=!0,Y.value=r},ke=e.value;return Ae(async()=>{var r,t;await N(),await P(),await H(),await j(),await F(),e.value=`${(t=(r=h.value)==null?void 0:r.name)==null?void 0:t.toUpperCase()} - SANCHEZ INVERSIONES`}),Me(()=>{e.value=ke}),(r,t)=>{var k,R,U,Z,se,ae;const $=Ne("auto-animate");return y(),V("div",Ze,[a("div",ze,[a("div",null,[a("h1",Xe,S((k=f.value)==null?void 0:k.raffle_name),1),a("h2",Je,S((R=h.value)==null?void 0:R.name),1),a("p",null,S((U=h.value)==null?void 0:U.phone),1)]),a("div",Ke,[a("p",null,S(s(Be)((Z=c.value)==null?void 0:Z.ticket_price)),1),a("p",null,S((se=f.value)==null?void 0:se.lottery_name),1),a("p",Qe,S(s($e)(new Date(Date.parse((ae=f.value)==null?void 0:ae.draw_drawn_at)),"dddd DD [de] MMMM [de] YYYY")),1)])]),a("div",et,[(y(!0),V(X,null,J(te.value,g=>(y(),V("div",{key:g.group,class:"flex items-center gap-4 print:gap-1 border p-4 print:p-2 rounded-md break-before-auto"},[a("div",tt,[a("h3",lt,S(g.group),1)]),a("div",st,[(y(!0),V(X,null,J(g.sellerTickets,A=>(y(),I(s(He),{key:A.id,as:"button",class:"ml-2 button small",onTrigger:Te=>le(A)},{default:u(()=>[d(s(M),{variant:"ghost",onContextmenu:qe(Te=>le(A),["prevent"]),class:"border-primary print:min-w-10 print:min-h-10 print:w-10 print:h-10 print:text-sm print:font-extrabold print:rounded-md text-lg min-w-14 min-h-14 w-14 h-14 border rounded-full flex-col justify-center items-center"},{default:u(()=>[a("span",at,S(A.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),d(s(M),{onClick:A=>L(g.group),variant:"ghost",class:"print:hidden text-lg w-14 h-14 border rounded-full"},{default:u(()=>[q(" + ")]),_:2},1032,["onClick"])])]))),128)),a("div",rt,[a("div",nt,[ot,a("div",it,[d(s(M),{variant:"ghost",class:"print:hidden text-lg w-14 h-14 border"},{default:u(()=>[q(" + ")]),_:1})])]),a("div",ut,[a("div",ct,[dt,a("p",ft,S(i.value),1)])])])]),d(s(pe),{open:b.value,"onUpdate:open":t[0]||(t[0]=g=>b.value=g)},{default:u(()=>[d(s(ue),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:u(()=>[d(s(ce),{class:"p-6 pb-4 border-b"},{default:u(()=>[d(s(de),null,{default:u(()=>[a("div",vt,[d(s(ie),{class:"w-8 h-8"}),pt])]),_:1}),d(s(fe),null,{default:u(()=>[q(" Seleccione una o más boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),a("div",mt,[a("div",_t,[(y(!0),V(X,null,J(E.value,g=>(y(),I(s(M),{key:g.id,variant:"ghost",class:Ie(["text-lg w-14 h-14 border rounded-full",{"bg-green-600 hover:bg-green-700":O(g)}]),onClick:A=>C(g),disabled:m.value},{default:u(()=>[q(S(g.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),d(s(me),{class:"p-6 pt-4 border-t gap-2"},{default:u(()=>[d(s(_e),{"as-child":""},{default:u(()=>[d(s(M),{variant:"secondary",type:"button",disabled:m.value},{default:u(()=>[q("Cancelar")]),_:1},8,["disabled"])]),_:1}),ne((y(),I(s(M),{onClick:be,class:"gap-3",form:"raffle-form",type:"submit",disabled:m.value},{default:u(()=>[m.value?(y(),I(s(oe),{key:0,class:"h-6 w-6"})):(y(),I(s(ve),{key:1,class:"w-6 h-6"})),gt]),_:1},8,["disabled"])),[[$]])]),_:1})]),_:1})]),_:1},8,["open"]),d(s(pe),{open:T.value,"onUpdate:open":t[2]||(t[2]=g=>T.value=g)},{default:u(()=>[d(s(ue),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:u(()=>[d(s(ce),{class:"p-6 pb-4 border-b"},{default:u(()=>[d(s(de),null,{default:u(()=>[a("div",ht,[d(s(ie),{class:"w-8 h-8"}),wt])]),_:1}),d(s(fe),null,{default:u(()=>[q(" Esta acción removerá la boleta de este vendedor ")]),_:1})]),_:1}),a("div",xt,[d(s(M),{variant:"ghost",class:"text-4xl w-32 h-32 border rounded-full",disabled:m.value},{default:u(()=>{var g;return[q(S((g=Y.value)==null?void 0:g.number),1)]}),_:1},8,["disabled"])]),d(s(me),{class:"p-6 pt-4 border-t gap-2"},{default:u(()=>[d(s(_e),{"as-child":""},{default:u(()=>[d(s(M),{variant:"secondary",type:"button",disabled:m.value},{default:u(()=>[q("Cancelar")]),_:1},8,["disabled"])]),_:1}),ne((y(),I(s(M),{onClick:t[1]||(t[1]=g=>{var A;return ye((A=Y.value)==null?void 0:A.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:m.value},{default:u(()=>[m.value?(y(),I(s(oe),{key:0,class:"h-6 w-6"})):(y(),I(s(ve),{key:1,class:"w-6 h-6"})),bt]),_:1},8,["disabled"])),[[$]])]),_:1})]),_:1})]),_:1},8,["open"]),yt])}}});export{Lt as default};
