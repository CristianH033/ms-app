import{d as ce,P as de,r as c,l as M,p as fe,q as pe,o as n,c as x,a as t,t as d,e as s,F as B,i as N,b as r,w as l,s as _,_ as p,v as P,j as v,S as U,M as h,U as me,n as _e,Q as ve}from"./index-Chp61eov.js";import{S as z}from"./ticket-line-duotone-Cob3aE25.js";import{S as Q}from"./add-circle-line-duotone-DRVsw6s-.js";import{_ as H,a as J,b as K,c as W}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DPLj-ZFa.js";import{_ as X}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-Du8itY4R.js";import{_ as Y,a as Z}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-BAXuQO1F.js";import{n as ge}from"./strings-BzWVocVB.js";import{O as he}from"./index-B55Yd5Ot.js";const be={class:"p-4 rounded-md mx-auto"},we={class:"flex justify-between items-center mb-4"},xe={class:"text-2xl font-bold"},ke={class:"text-xl uppercase"},ye={class:"text-right max-w-80"},Te={class:"space-y-4"},Se={class:"tabular-nums self-start"},Ce={class:"text-7xl"},$e={class:"flex flex-wrap gap-2"},qe={class:"pointer-events-none"},Re=t("div",{class:"w-full h-16"},null,-1),De=t("h3",{class:"text-xl break-before-page"},"Pulles",-1),Ee={class:"flex items-center gap-4 border p-4 rounded-md"},Ge={class:"flex gap-2"},je={class:"flex flex-row gap-2 justify-start items-center"},Be=t("span",null," Asignar Boletas ",-1),Ne={class:"px-6 py-4 overflow-y-auto relative max-h-[55dvh]"},Ae={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},Fe=t("span",null,"Asignar",-1),Le={class:"flex flex-row gap-2 justify-start items-center"},Ie=t("span",null," Remover Boleta ",-1),Oe={class:"flex flex-row gap-2 justify-center items-center p-4"},Ve=t("span",null,"Remover",-1),Xe=ce({__name:"SellerRaffleView",setup(Me){const A=de(),k=A.currentRoute.value.params.id,y=A.currentRoute.value.params.seller_id,$=c(),q=c(),F=c(),L=c([]),R=c([]),g=c(null),b=c(!1),T=c(!1),i=c(!1),S=c(""),D=c(null),ee=M(()=>{const e=Array.from(new Set(R.value.map(u=>u.number[0]))).map(u=>({group:u,sellerTickets:R.value.filter(w=>w.number[0]===u)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(u=>e.find(C=>C.group===u.group)||u)}),se=M(()=>(console.log(S.value),S.value?L.value.filter(a=>a.number[0]===S.value):[])),ae=a=>{S.value=a,ve(()=>{b.value=!0})},te=a=>{var e,m;(e=g.value)!=null&&e.includes(a.id)?g.value=(m=g.value)==null?void 0:m.filter(u=>u!==a.id):g.value=[...g.value??[],a.id]},le=a=>{var e;return(e=g.value)==null?void 0:e.includes(a.id)},re=async()=>{const{data:a,error:e}=await h.from("raffle_stats").select("*").eq("raffle_id",k).single();if(e)throw new Error(e.message);$.value=a},oe=async()=>{const{data:a,error:e}=await h.from("sellers").select("*").eq("id",y).single();if(e)throw new Error(e.message);q.value=a},E=async()=>{const{data:a,error:e}=await h.from("tickets").select("*").eq("raffle_id",k).eq("seller_id",y);if(e)throw new Error(e.message);R.value=a},G=async()=>{const{data:a,error:e}=await h.from("tickets").select("*").eq("raffle_id",k).is("seller_id",null);if(e)throw new Error(e.message);L.value=a},j=async()=>{const{data:a,error:e}=await h.from("raffles_sellers").select("*").eq("raffle_id",k).eq("seller_id",y).single();if(e)throw new Error(e.message);F.value=a},ne=async()=>{var e;i.value=!0;const{error:a}=await h.from("tickets").update({seller_id:Number(y)}).in("id",(e=g.value)==null?void 0:e.map(m=>Number(m)));if(a)throw new Error(a.message);j(),G(),E(),i.value=!1,b.value=!1},ie=async a=>{i.value=!0;const{error:e}=await h.from("tickets").update({seller_id:null}).eq("id",a);if(e)throw new Error(e.message);j(),G(),E(),i.value=!1,T.value=!1},I=a=>{T.value=!0,D.value=a};return fe(()=>{re(),oe(),j(),E(),G()}),(a,e)=>{var u,w,C,O,V;const m=pe("auto-animate");return n(),x("div",be,[t("div",we,[t("div",null,[t("h1",xe,d((u=$.value)==null?void 0:u.raffle_name),1),t("h2",ke,d((w=q.value)==null?void 0:w.name),1),t("p",null,d((C=q.value)==null?void 0:C.phone),1)]),t("div",ye,[t("p",null,d(s(ge)((O=F.value)==null?void 0:O.ticket_price)),1),t("p",null,d((V=$.value)==null?void 0:V.description),1)])]),t("div",Te,[(n(!0),x(B,null,N(ee.value,o=>(n(),x("div",{key:o.group,class:"flex items-center gap-4 print:gap-1 border p-4 print:p-1 rounded-md break-before-auto"},[t("div",Se,[t("h3",Ce,d(o.group),1)]),t("div",$e,[(n(!0),x(B,null,N(o.sellerTickets,f=>(n(),v(s(he),{key:f.id,as:"button",class:"ml-2 button small",onTrigger:ue=>I(f)},{default:l(()=>[r(s(p),{variant:"ghost",onContextmenu:me(ue=>I(f),["prevent"]),class:"text-lg w-14 h-14 print:w-8 print:h-8 border rounded-full print:text-xs flex-col justify-center items-center"},{default:l(()=>[t("span",qe,d(f.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),r(s(p),{onClick:f=>ae(o.group),variant:"ghost",class:"print:hidden text-lg w-14 h-14 border rounded-full"},{default:l(()=>[_(" + ")]),_:2},1032,["onClick"])])]))),128)),t("pre",null,d(b.value),1),Re,De,t("div",Ee,[t("div",Ge,[r(s(p),{variant:"ghost",class:"print:hidden text-lg w-14 h-14 border"},{default:l(()=>[_(" + ")]),_:1})])])]),r(s(W),{open:b.value,"onUpdate:open":e[0]||(e[0]=o=>b.value=o)},{default:l(()=>[r(s(H),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(s(J),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(s(K),null,{default:l(()=>[t("div",je,[r(s(z),{class:"w-8 h-8"}),Be])]),_:1}),r(s(X),null,{default:l(()=>[_(" Seleccione una o más boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),t("div",Ne,[t("div",Ae,[(n(!0),x(B,null,N(se.value,o=>(n(),v(s(p),{key:o.id,variant:"ghost",class:_e(["text-lg w-14 h-14 border rounded-full",{"bg-green-600 hover:bg-green-700":le(o)}]),onClick:f=>te(o),disabled:i.value},{default:l(()=>[_(d(o.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),r(s(Y),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(s(Z),{"as-child":""},{default:l(()=>[r(s(p),{variant:"secondary",type:"button",disabled:i.value},{default:l(()=>[_("Cancelar")]),_:1},8,["disabled"])]),_:1}),P((n(),v(s(p),{onClick:ne,class:"gap-3",form:"raffle-form",type:"submit",disabled:i.value},{default:l(()=>[i.value?(n(),v(s(U),{key:0,class:"h-6 w-6"})):(n(),v(s(Q),{key:1,class:"w-6 h-6"})),Fe]),_:1},8,["disabled"])),[[m]])]),_:1})]),_:1})]),_:1},8,["open"]),r(s(W),{open:T.value,"onUpdate:open":e[2]||(e[2]=o=>T.value=o)},{default:l(()=>[r(s(H),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(s(J),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(s(K),null,{default:l(()=>[t("div",Le,[r(s(z),{class:"w-8 h-8"}),Ie])]),_:1}),r(s(X),null,{default:l(()=>[_(" Esta acción removerá la boleta de este vendedor ")]),_:1})]),_:1}),t("div",Oe,[r(s(p),{variant:"ghost",class:"text-4xl w-32 h-32 border rounded-full",disabled:i.value},{default:l(()=>{var o;return[_(d((o=D.value)==null?void 0:o.number),1)]}),_:1},8,["disabled"])]),r(s(Y),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(s(Z),{"as-child":""},{default:l(()=>[r(s(p),{variant:"secondary",type:"button",disabled:i.value},{default:l(()=>[_("Cancelar")]),_:1},8,["disabled"])]),_:1}),P((n(),v(s(p),{onClick:e[1]||(e[1]=o=>{var f;return ie((f=D.value)==null?void 0:f.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:i.value},{default:l(()=>[i.value?(n(),v(s(U),{key:0,class:"h-6 w-6"})):(n(),v(s(Q),{key:1,class:"w-6 h-6"})),Ve]),_:1},8,["disabled"])),[[m]])]),_:1})]),_:1})]),_:1},8,["open"])])}}});export{Xe as default};
