function Z(e,t,r){if(e>100||t>100)throw new Error(`${e}x${t} doesn't fit in 100x100`);let{PI:l,round:c,max:o,cos:p,abs:d}=Math,x=0,g=0,_=0,n=0;for(let u=0,h=0;u<e*t;u++,h+=4){let f=r[h+3]/255;x+=f/255*r[h],g+=f/255*r[h+1],_+=f/255*r[h+2],n+=f}n&&(x/=n,g/=n,_/=n);let s=n<e*t,$=s?5:7,k=o(1,c($*e/o(e,t))),O=o(1,c($*t/o(e,t))),D=[],A=[],G=[],z=[];for(let u=0,h=0;u<e*t;u++,h+=4){let f=r[h+3]/255,q=x*(1-f)+f/255*r[h],a=g*(1-f)+f/255*r[h+1],i=_*(1-f)+f/255*r[h+2];D[u]=(q+a+i)/3,A[u]=(q+a)/2-i,G[u]=q-a,z[u]=f}let I=(u,h,f)=>{let q=0,a=[],i=0,b=[];for(let m=0;m<f;m++)for(let w=0;w*f<h*(f-m);w++){let S=0;for(let U=0;U<e;U++)b[U]=p(l/e*w*(U+.5));for(let U=0;U<t;U++)for(let N=0,Y=p(l/t*m*(U+.5));N<e;N++)S+=u[N+U*e]*b[N]*Y;S/=e*t,w||m?(a.push(S),i=o(i,d(S))):q=S}if(i)for(let m=0;m<a.length;m++)a[m]=.5+.5/i*a[m];return[q,a,i]},[J,v,Q]=I(D,o(3,k),o(3,O)),[V,K,W]=I(A,3,3),[M,C,F]=I(G,3,3),[j,P,E]=s?I(z,5,5):[],B=e>t,y=c(63*J)|c(31.5+31.5*V)<<6|c(31.5+31.5*M)<<12|c(31*Q)<<18|s<<23,R=(B?O:k)|c(63*W)<<3|c(63*F)<<9|B<<15,T=[y&255,y>>8&255,y>>16,R&255,R>>8],H=s?6:5,L=0;s&&T.push(c(15*j)|c(15*E)<<4);for(let u of s?[v,K,C,P]:[v,K,C])for(let h of u)T[H+(L>>1)]|=c(15*h)<<((L++&1)<<2);return new Uint8Array(T)}function ee(e){let{PI:t,min:r,max:l,cos:c,round:o}=Math,p=e[0]|e[1]<<8|e[2]<<16,d=e[3]|e[4]<<8,x=(p&63)/63,g=(p>>6&63)/31.5-1,_=(p>>12&63)/31.5-1,n=(p>>18&31)/31,s=p>>23,$=(d>>3&63)/63,k=(d>>9&63)/63,O=d>>15,D=l(3,O?s?5:7:d&7),A=l(3,O?d&7:s?5:7),G=s?(e[5]&15)/15:1,z=(e[5]>>4)/15,I=s?6:5,J=0,v=(B,y,R)=>{let T=[];for(let H=0;H<y;H++)for(let L=H?0:1;L*y<B*(y-H);L++)T.push(((e[I+(J>>1)]>>((J++&1)<<2)&15)/7.5-1)*R);return T},Q=v(D,A,n),V=v(3,3,$*1.25),K=v(3,3,k*1.25),W=s&&v(5,5,z),M=te(e),C=o(M>1?32:32*M),F=o(M>1?32/M:32),j=new Uint8Array(C*F*4),P=[],E=[];for(let B=0,y=0;B<F;B++)for(let R=0;R<C;R++,y+=4){let T=x,H=g,L=_,u=G;for(let a=0,i=l(D,s?5:3);a<i;a++)P[a]=c(t/C*(R+.5)*a);for(let a=0,i=l(A,s?5:3);a<i;a++)E[a]=c(t/F*(B+.5)*a);for(let a=0,i=0;a<A;a++)for(let b=a?0:1,m=E[a]*2;b*A<D*(A-a);b++,i++)T+=Q[i]*P[b]*m;for(let a=0,i=0;a<3;a++)for(let b=a?0:1,m=E[a]*2;b<3-a;b++,i++){let w=P[b]*m;H+=V[i]*w,L+=K[i]*w}if(s)for(let a=0,i=0;a<5;a++)for(let b=a?0:1,m=E[a]*2;b<5-a;b++,i++)u+=W[i]*P[b]*m;let h=T-2/3*H,f=(3*T-h+L)/2,q=f-L;j[y]=l(0,255*r(1,f)),j[y+1]=l(0,255*r(1,q)),j[y+2]=l(0,255*r(1,h)),j[y+3]=l(0,255*r(1,u))}return{w:C,h:F,rgba:j}}function te(e){let t=e[3],r=e[2]&128,l=e[4]&128,c=l?r?5:7:t&7,o=l?t&7:r?5:7;return c/o}function ae(e,t,r){let l=e*4+1,c=6+t*(5+l),o=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,c>>>24,c>>16&255,c>>8&255,c&255,73,68,65,84,120,1],p=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188],d=1,x=0;for(let g=0,_=0,n=l-1;g<t;g++,n+=l-1)for(o.push(g+1<t?0:1,l&255,l>>8,~l&255,l>>8^255,0),x=(x+d)%65521;_<n;_++){let s=r[_]&255;o.push(s),d=(d+s)%65521,x=(x+d)%65521}o.push(x>>8,x&255,d>>8,d&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[g,_]of[[12,29],[37,41+c]]){let n=-1;for(let s=g;s<_;s++)n^=o[s],n=n>>>4^p[n&15],n=n>>>4^p[n&15];n=~n,o[_++]=n>>>24,o[_++]=n>>16&255,o[_++]=n>>8&255,o[_++]=n&255}return"data:image/png;base64,"+btoa(String.fromCharCode(...o))}function X(e){let t=ee(e);return ae(t.w,t.h,t.rgba)}const le=async e=>{const t=new Image;t.src=URL.createObjectURL(e),await new Promise(d=>{t.onload=d});const r=document.createElement("canvas"),l=r.getContext("2d"),c=100/Math.max(t.width,t.height);r.width=Math.round(t.width*c)||100,r.height=Math.round(t.height*c)||100,l==null||l.drawImage(t,0,0,r.width,r.height);const o=l==null?void 0:l.getImageData(0,0,r.width,r.height),p=Z(o.width,o.height,o.data);return URL.revokeObjectURL(t.src),r.remove(),p},re=e=>btoa(String.fromCharCode(...e)),oe=e=>new Uint8Array(atob(e).split("").map(t=>t.charCodeAt(0))),ce=e=>oe(e),ne=async e=>{const t=await le(e);return await re(t)},se=e=>X(e),ie=e=>X(ce(e));export{se as a,ie as b,ne as f};
