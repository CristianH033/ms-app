import{d as K,P as Q,r as c,l as L,p as W,q as X,o as i,c as b,a,t as u,e as t,F as D,i as G,b as r,w as l,s as d,_ as f,v as Y,j as w,S as Z,V as v,n as ee,U as se}from"./index-Dy2Zx3DR.js";import{S as ae}from"./ticket-line-duotone-CuZwHL7x.js";import{S as te}from"./add-circle-line-duotone-CD2AV8Je.js";import{_ as le,a as re,b as oe,c as ne}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-4B9VoTOt.js";import{_ as ie}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-8Ggl7B0S.js";import{_ as ce,a as ue}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-5x8kFR9m.js";import{n as de}from"./strings-BzWVocVB.js";const fe={class:"p-4 rounded-md mx-auto"},pe={class:"flex justify-between items-center mb-4"},_e={class:"text-2xl font-bold"},me={class:"text-xl uppercase"},ve={class:"text-right max-w-80"},ge={class:"space-y-4"},he={class:"tabular-nums self-start"},be={class:"text-7xl"},we={class:"flex flex-wrap gap-2"},xe=a("div",{class:"w-full h-16"},null,-1),ke=a("h3",{class:"text-xl break-before-page"},"Pulles",-1),ye={class:"flex items-center gap-4 border p-4 rounded-md"},Te={class:"flex gap-2"},Se={class:"flex flex-row gap-2 justify-start items-center"},Ce=a("span",null," Asignar Boletas ",-1),qe={class:"px-6 py-4 overflow-y-auto relative max-h-[55dvh]"},$e={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},De=a("span",null,"Asignar",-1),Ie=K({__name:"SellerRaffleView",setup(Ge){const E=Q(),x=E.currentRoute.value.params.id,k=E.currentRoute.value.params.seller_id,C=c(),q=c(),R=c(),N=c([]),$=c([]),p=c(null),g=c(!1),m=c(!1),y=c(""),j=L(()=>{const e=Array.from(new Set($.value.map(o=>o.number[0]))).map(o=>({group:o,sellerTickets:$.value.filter(h=>h.number[0]===o)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(o=>e.find(T=>T.group===o.group)||o)}),P=L(()=>(console.log(y.value),y.value?N.value.filter(s=>s.number[0]===y.value):[])),U=s=>{y.value=s,se(()=>{g.value=!0})},z=s=>{var e,_;(e=p.value)!=null&&e.includes(s.id)?p.value=(_=p.value)==null?void 0:_.filter(o=>o!==s.id):p.value=[...p.value??[],s.id]},M=s=>{var e;return(e=p.value)==null?void 0:e.includes(s.id)},O=async()=>{const{data:s,error:e}=await v.from("raffle_stats").select("*").eq("raffle_id",x).single();if(e)throw new Error(e.message);C.value=s},H=async()=>{const{data:s,error:e}=await v.from("sellers").select("*").eq("id",k).single();if(e)throw new Error(e.message);q.value=s},A=async()=>{const{data:s,error:e}=await v.from("tickets").select("*").eq("raffle_id",x).eq("seller_id",k);if(e)throw new Error(e.message);$.value=s},B=async()=>{const{data:s,error:e}=await v.from("tickets").select("*").eq("raffle_id",x).is("seller_id",null);if(e)throw new Error(e.message);N.value=s},F=async()=>{const{data:s,error:e}=await v.from("raffles_sellers").select("*").eq("raffle_id",x).eq("seller_id",k).single();if(e)throw new Error(e.message);R.value=s},J=async()=>{var e;m.value=!0;const{error:s}=await v.from("tickets").update({seller_id:Number(k)}).in("id",(e=p.value)==null?void 0:e.map(_=>Number(_)));if(s)throw new Error(s.message);F(),B(),A(),m.value=!1,g.value=!1};return W(()=>{O(),H(),F(),A(),B()}),(s,e)=>{var o,h,T,V,I;const _=X("auto-animate");return i(),b("div",fe,[a("div",pe,[a("div",null,[a("h1",_e,u((o=C.value)==null?void 0:o.raffle_name),1),a("h2",me,u((h=q.value)==null?void 0:h.name),1),a("p",null,u((T=q.value)==null?void 0:T.phone),1)]),a("div",ve,[a("p",null,u(t(de)((V=R.value)==null?void 0:V.ticket_price)),1),a("p",null,u((I=C.value)==null?void 0:I.description),1)])]),a("div",ge,[(i(!0),b(D,null,G(j.value,n=>(i(),b("div",{key:n.group,class:"flex items-center gap-4 print:gap-1 border p-4 print:p-1 rounded-md break-before-auto"},[a("div",he,[a("h3",be,u(n.group),1)]),a("div",we,[(i(!0),b(D,null,G(n.sellerTickets,S=>(i(),w(t(f),{key:S.id,variant:"ghost",class:"print:bg-black print:text-white text-lg w-14 h-14 print:w-8 print:h-8 border rounded-full print:text-xs"},{default:l(()=>[d(u(S.number),1)]),_:2},1024))),128)),r(t(f),{onClick:S=>U(n.group),variant:"ghost",class:"print:hidden text-lg w-14 h-14 border rounded-full"},{default:l(()=>[d(" + ")]),_:2},1032,["onClick"])])]))),128)),a("pre",null,u(g.value),1),xe,ke,a("div",ye,[a("div",Te,[r(t(f),{class:"text-lg w-14 h-14 border bg-green-700 rounded-md"},{default:l(()=>[d(" 12 ")]),_:1}),r(t(f),{variant:"ghost",class:"text-lg w-14 h-14 border bg-green-700 rounded-md"},{default:l(()=>[d(" 14 ")]),_:1}),r(t(f),{variant:"ghost",class:"print:hidden text-lg w-14 h-14 border"},{default:l(()=>[d(" + ")]),_:1})])])]),r(t(ne),{open:g.value,"onUpdate:open":e[0]||(e[0]=n=>g.value=n)},{default:l(()=>[r(t(le),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:l(()=>[r(t(re),{class:"p-6 pb-4 border-b"},{default:l(()=>[r(t(oe),null,{default:l(()=>[a("div",Se,[r(t(ae),{class:"w-8 h-8"}),Ce])]),_:1}),r(t(ie),null,{default:l(()=>[d(" Seleccione una o mÃ¡s boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),a("div",qe,[a("div",$e,[(i(!0),b(D,null,G(P.value,n=>(i(),w(t(f),{key:n.id,variant:"ghost",class:ee(["text-lg w-14 h-14 border rounded-full",{"bg-green-600 hover:bg-green-700":M(n)}]),onClick:S=>z(n),disabled:m.value},{default:l(()=>[d(u(n.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),r(t(ce),{class:"p-6 pt-4 border-t gap-2"},{default:l(()=>[r(t(ue),{"as-child":""},{default:l(()=>[r(t(f),{variant:"secondary",type:"button",disabled:m.value},{default:l(()=>[d("Cancelar")]),_:1},8,["disabled"])]),_:1}),Y((i(),w(t(f),{onClick:J,class:"gap-3",form:"raffle-form",type:"submit",disabled:m.value},{default:l(()=>[m.value?(i(),w(t(Z),{key:0,class:"h-6 w-6"})):(i(),w(t(te),{key:1,class:"w-6 h-6"})),De]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"])])}}});export{Ie as default};
