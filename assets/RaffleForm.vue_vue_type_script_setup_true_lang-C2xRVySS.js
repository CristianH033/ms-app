import{o as u,c as d,a as c,d as K,ai as re,v as p,aj as ue,e,ak as de,n as me,E as ce,al as L,am as fe,r as F,an as _e,ao as pe,l as ve,p as he,q as ge,b as a,w as l,s as f,D as k,_ as T,Q as U,F as H,i as Z,y as be,z as we,ap as ye,j as E,t as G,S as ke}from"./index-CUhxv6Jf.js";import{t as Se,z as _,u as ze,_ as h,a as g,b,c as w,F as y}from"./FormMessage.vue_vue_type_script_setup_true_lang-PVxMqvpA.js";import{_ as M}from"./Input.vue_vue_type_script_setup_true_lang-ChWTV_R9.js";import{_ as xe,g as O}from"./DrawForm.vue_vue_type_script_setup_true_lang-DSbiMqgN.js";import{_ as Ve,a as $e,b as qe,c as Ee,d as Ce,e as Ne,f as De}from"./SelectScrollDownButton.vue_vue_type_script_setup_true_lang-C2fG2d7D.js";import{v as Q,_ as W,u as Fe}from"./storage-CnIA73IT.js";import{_ as X}from"./MoneyInput.vue_vue_type_script_setup_true_lang-BaD5Hfze.js";import{S as R}from"./add-circle-line-duotone-t6VpUcYn.js";import{S as Te}from"./cup-star-line-duotone-MdoBZCHU.js";import{c as Ue}from"./raffles-D2XaxBih.js";import{c as Me,_ as Re,a as Pe,b as Ae}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-E2-iY_zX.js";import{_ as je}from"./AlertDialogTrigger.vue_vue_type_script_setup_true_lang-CZLe4D9Y.js";const Be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ie=c("g",{fill:"none",stroke:"currentColor","stroke-width":"1.5"},[c("path",{d:"M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z",opacity:".5"}),c("path",{"stroke-linecap":"round",d:"m14.5 9.5l-5 5m0-5l5 5"})],-1),Le=[Ie];function He(z,$){return u(),d("svg",Be,[...Le])}const Ze={name:"solar-close-square-line-duotone",render:He},Ge=K({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(z,{emit:$}){const S=z,m=re(S,"modelValue",$,{passive:!0,defaultValue:S.defaultValue});return(x,o)=>p((u(),d("textarea",{"onUpdate:modelValue":o[0]||(o[0]=q=>de(m)?m.value=q:null),class:me(e(ce)("flex min-h-20 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",S.class))},null,2)),[[ue,e(m)]])}}),Oe=["aria-disabled"],Qe=["disabled"],We={class:"flex flex-row gap-2"},Xe={key:0,class:"p-4",value:""},Ye={class:"grid gap-4 sm:grid-cols-2 sm:gap-6"},Je={class:"border col-span-2 rounded-md p-4 flex flex-col gap-4"},Ke={class:"text-lg font-medium flex gap-2"},ea=c("span",null,"Premios",-1),aa=["onClick"],la={class:"w-full border p-4 rounded-md"},sa={class:"text-lg font-medium"},ta={class:"w-full py-2 flex flex-row items-center justify-end"},oa=c("span",null,"Agregar premio",-1),na=c("span",null,"Crear",-1),Y=1,J=5e6,ba=K({__name:"RaffleForm",props:L({withoutActions:{type:[Boolean,String],default:!1}},{isSubmiting:{type:Boolean,required:!1,default:!1},isSubmitingModifiers:{}}),emits:L(["success"],["update:isSubmiting"]),setup(z,{emit:$}){const S=["image/jpeg","image/jpg","image/png","image/webp"],C=z,m=fe(z,"isSubmiting"),x=F([]),o=F({draw_id:"1",name:"Test",description:"Test",image_path:null,thumb_hash:null,number_of_tickets:1e3,ticket_price:"120000",prizes:[{key:Q().slice(-10),name:"test",prize_value:"10000",image:null,thumb_hash:null}]}),q=_e(async()=>await O()),ee=pe(()=>{console.log("Clearing cache"),q.clear()},3e4),ae=Se(_.object({draw_id:_.string({required_error:"Sorteo es requerido"}).refine(async s=>{try{ee()}catch(t){console.error(t)}return await q().then(t=>t==null?void 0:t.some(n=>n.id.toString()===s))},{message:"El Sorteo no existe"}),name:_.string({required_error:"Nombre es requerido"}).min(3,{message:"Nombre debe tener al menos 3 caracteres"}),description:_.string({required_error:"La descripción es requerida"}).min(3,{message:"La descripción debe tener al menos 3 caracteres"}),number_of_tickets:_.number({required_error:"El numero de tickets es requerido"}).min(100,{message:"El numero de tickets debe ser mayor o igual a 100"}),ticket_price:_.string({required_error:"El valor es requerido"}).transform(s=>parseFloat(s)).refine(s=>!isNaN(s)&&s>=1,{message:"El valor debe ser un número mayor o igual a 1"}),prizes:_.array(_.object({name:_.string({required_error:"Nombre es requerido"}).min(3,{message:"Nombre debe tener al menos 3 caracteres"}),prize_value:_.string({required_error:"El valor es requerido"}).transform(s=>parseFloat(s)).refine(s=>!isNaN(s)&&s>=1,{message:"El valor debe ser un número mayor o igual a 1"}),image:_.instanceof(File).refine(s=>s instanceof File,{message:"Debe seleccionar una imagen"}).refine(s=>S.includes(s.type),{message:"Tipo de archivo no aceptado"}).refine(s=>s.size>=Y,{message:"El archivo está vacío"}).refine(s=>s.size<=J,{message:"El archivo es demasiado grande"})})).min(1),image:_.instanceof(File).refine(s=>s instanceof File,{message:"Debe seleccionar una imagen"}).refine(s=>S.includes(s.type),{message:"Tipo de archivo no aceptado"}).refine(s=>s.size>=Y,{message:"El archivo está vació"}).refine(s=>s.size<=J,{message:"El archivo es demasiado grande"})})),P=ze({validationSchema:ae,initialValues:{name:o.value.name,description:o.value.description,number_of_tickets:o.value.number_of_tickets,ticket_price:o.value.ticket_price,draw_id:o.value.draw_id,prizes:[{...o.value.prizes[0],image:new File([],"")}]}}),le=$,se=()=>{o.value.prizes.push({key:Q().slice(-10),name:"",prize_value:"",image:null,thumb_hash:null})},te=s=>{o.value.prizes.length>1&&o.value.prizes.find(n=>n.key===s)&&(o.value.prizes=o.value.prizes.filter(n=>n.key!==s))},A=async s=>{const t=await Fe(s,s.name);return t==null?void 0:t.fullPath},oe=async s=>{const t=await{draw_id:parseInt(s.draw_id),name:s.name,description:s.description,image_path:await A(s.image),thumb_hash:o.value.thumb_hash,number_of_tickets:s.number_of_tickets,ticket_price:s.ticket_price,prizes:[]};return await s.prizes.forEach(async(n,i)=>{await A(n.image).then(r=>{t.prizes.push({name:n.name,prize_value:n.prize_value,thumb_hash:o.value.prizes[i].thumb_hash,image_path:r})})}),t},j=P.handleSubmit(async s=>{m.value=!0,P.setErrors({}),m.value=!1;const t=await oe(s);Ue(t).then(n=>{console.log(n),le("success")}).catch(n=>{console.log(n)}).finally(()=>{m.value=!1})},({errors:s})=>{const t=Object.keys(s)[0].replace("[",".").replace("]",""),n=document.querySelector(`[name="${t}"]`);n&&n.scrollIntoView({behavior:"smooth",block:"center"})}),ne=ve(()=>C.withoutActions===""||C.withoutActions===!0),N=F(!1),B=()=>{N.value=!1},ie=async()=>{B(),await I()},I=async()=>{m.value=!0,await O().then(s=>x.value=s).finally(()=>m.value=!1),console.log(x.value)};return he(async()=>{await I()}),(s,t)=>{const n=ge("auto-animate");return u(),d("form",{onSubmit:t[7]||(t[7]=ye((...i)=>e(j)&&e(j)(...i),["prevent"])),class:"@container/form w-full flex flex-col gap-2","aria-disabled":m.value},[c("fieldset",{disabled:m.value},[a(e(y),{name:"name"},{default:l(({componentField:i})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Nombre")]),_:1}),a(e(b),null,{default:l(()=>[a(e(M),k({type:"text",placeholder:"Nombre de la Rifa"},i,{"model-value":o.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.name=r),required:""}),null,16,["model-value"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:1}),a(e(y),{name:"draw_id"},{default:l(({componentField:i})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Sorteo")]),_:1}),a(e(Ve),k(i,{"model-value":o.value.draw_id,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.draw_id=r)}),{default:l(()=>[a(e(b),null,{default:l(()=>[c("div",We,[a(e($e),null,{default:l(()=>[a(e(qe),{placeholder:"Elige un sorteo"})]),_:1}),a(e(Me),{open:N.value,"onUpdate:open":t[1]||(t[1]=r=>N.value=r)},{default:l(()=>[a(e(je),{"as-child":""},{default:l(()=>[a(e(T),{variant:"outline",type:"button"},{default:l(()=>[a(e(R),{class:"w-6 h-6"})]),_:1})]),_:1}),a(e(Re),null,{default:l(()=>[a(e(Pe),null,{default:l(()=>[a(e(Ae),null,{default:l(()=>[f("Crear nuevo sorteo")]),_:1}),a(xe,{onSuccess:ie,onCancel:B})]),_:1})]),_:1})]),_:1},8,["open"])])]),_:1}),a(e(Ee),null,{default:l(()=>[a(e(Ce),null,{default:l(()=>[a(e(Ne),null,{default:l(()=>[f("Sorteos")]),_:1}),x.value.length===0?(u(),d("div",Xe,"No hay sorteos")):U("",!0),(u(!0),d(H,null,Z(x.value,r=>(u(),E(e(De),{key:r.id,value:r.id.toString()},{default:l(()=>[f(G(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:2},1040,["model-value"]),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:1}),a(e(y),{name:"description"},{default:l(({componentField:i})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Descripción")]),_:1}),a(e(b),null,{default:l(()=>[a(e(Ge),k({type:"text",placeholder:"Descripción de la Rifa"},i,{"model-value":o.value.description,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.description=r),required:""}),null,16,["model-value"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:1}),a(e(y),{name:"number_of_tickets"},{default:l(({componentField:i})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Número de Bonos:")]),_:1}),a(e(b),null,{default:l(()=>[a(e(M),k({type:"number",inputmode:"numeric",placeholder:"Nombre de la Rifa"},i,{"model-value":o.value.number_of_tickets,"onUpdate:modelValue":t[4]||(t[4]=r=>o.value.number_of_tickets=r),required:""}),null,16,["model-value"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:1}),a(e(y),{name:"ticket_price"},{default:l(({value:i,handleChange:r})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Costo del Bono")]),_:1}),a(e(b),null,{default:l(()=>[a(X,{"model-value":i,"onUpdate:modelValue":[v=>r(v,!0),t[5]||(t[5]=v=>o.value.ticket_price=v)],modelValue:o.value.ticket_price,required:""},null,8,["model-value","onUpdate:modelValue","modelValue"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:1}),a(e(y),{name:"image"},{default:l(({componentField:i})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Portada de la rifa")]),_:1}),a(e(b),null,{default:l(()=>[a(W,k(i,{base64ThumbHash:o.value.thumb_hash,"onUpdate:base64ThumbHash":t[6]||(t[6]=r=>o.value.thumb_hash=r)}),null,16,["base64ThumbHash"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:1}),c("div",Ye,[p((u(),d("fieldset",Je,[c("legend",Ke,[a(e(Te),{class:"w-8 h-8"}),ea]),(u(!0),d(H,null,Z(o.value.prizes,(i,r)=>(u(),d("div",{class:"w-full relative",key:i.key},[o.value.prizes.length>1?(u(),d("button",{key:0,type:"button",class:"bg-background rounded-xl absolute right-0 top-0",onClick:v=>te(i.key)},[a(e(Ze),{class:"w-8 h-8"})],8,aa)):U("",!0),c("fieldset",la,[c("legend",sa,"Premio "+G(r+1),1),a(e(y),{name:"prizes."+r+".name"},{default:l(({componentField:v})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Nombre")]),_:1}),a(e(b),null,{default:l(()=>[a(e(M),k({type:"text",placeholder:"Nombre del premio",ref_for:!0},v,{"model-value":i.name,"onUpdate:modelValue":V=>i.name=V,required:""}),null,16,["model-value","onUpdate:modelValue"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:2},1032,["name"]),a(e(y),{name:"prizes."+r+".prize_value"},{default:l(({value:v,handleChange:V})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Valor del premio")]),_:1}),a(e(b),null,{default:l(()=>[a(X,{"model-value":v,"onUpdate:modelValue":[D=>V(D,!0),D=>i.prize_value=D],modelValue:i.prize_value,required:""},null,8,["model-value","onUpdate:modelValue","modelValue"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:2},1032,["name"]),a(e(y),{name:"prizes."+r+".image"},{default:l(({componentField:v})=>[a(e(h),null,{default:l(()=>[a(e(g),null,{default:l(()=>[f("Imagen")]),_:1}),a(e(b),null,{default:l(()=>[a(W,k({ref_for:!0},v,{base64ThumbHash:i.thumb_hash,"onUpdate:base64ThumbHash":V=>i.thumb_hash=V}),null,16,["base64ThumbHash","onUpdate:base64ThumbHash"])]),_:2},1024),p((u(),d("div",null,[a(e(w))])),[[n]])]),_:2},1024)]),_:2},1032,["name"])])]))),128)),c("div",ta,[a(e(T),{variant:"outline",type:"button",class:"w-full gap-2 @xl/form:w-auto",onClick:se},{default:l(()=>[a(e(R),{class:"w-6 h-6"}),oa]),_:1})])])),[[n]])]),ne.value?U("",!0):be(s.$slots,"actions",we(k({key:0},{isSubmiting:m.value})),()=>[a(e(h),{class:"w-full py-2 flex flex-row items-center justify-end"},{default:l(()=>[p((u(),E(e(T),{type:"submit",class:"w-full gap-2 @xl/form:w-auto"},{default:l(()=>[m.value?(u(),E(e(ke),{key:0,class:"h-6 w-6"})):(u(),E(e(R),{key:1,class:"w-6 h-6"})),na]),_:1})),[[n]])]),_:1})])],8,Qe)],40,Oe)}}});export{ba as _};
