import{d as ue,P as fe,r as c,l as Y,p as pe,q as me,o as n,c as x,a,t as u,e as s,U as _e,F as E,i as R,b as l,w as r,s as v,_ as f,v as P,j as g,S as U,M as b,V as ve,n as ge,Q as he}from"./index-CrfhDVpB.js";import{S as z}from"./ticket-line-duotone-CQ8HDKlO.js";import{S as H}from"./add-circle-line-duotone-Q1JbNJ-l.js";import{_ as Q,a as Z,b as J,c as K}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-D9ekT1Jp.js";import{_ as W}from"./AlertDialogDescription.vue_vue_type_script_setup_true_lang-CIjKE1iB.js";import{_ as X,a as ee}from"./AlertDialogCancel.vue_vue_type_script_setup_true_lang-0n-KOYgm.js";import{n as be}from"./strings-BzWVocVB.js";import{O as we}from"./index-CUHWGoEo.js";const xe={class:"p-4 rounded-md mx-auto"},ye={class:"flex justify-between items-center mb-4"},ke={class:"text-primary text-2xl font-bold uppercase"},Te={class:"text-2xl font-bold uppercase"},Se={class:"text-right max-w-80"},Ce={class:"capitalize"},De={class:"space-y-4"},$e={class:"tabular-nums flex flex-row justify-center items-center self-start print:self-center print:w-32"},Ee={class:"text-7xl text-primary print:text-7xl"},Re={class:"flex flex-wrap gap-2"},qe={class:"pointer-events-none"},Ne={class:"flex items-center gap-4 border p-4 rounded-md"},je=a("h3",{class:"font-extrabold text-3xl text-primary"},"POOL",-1),Me={class:"flex flex-row flex-wrap gap-2"},Oe={class:"pointer-events-none user-select-none"},Be={class:"flex flex-row gap-2 justify-start items-center"},Ie=a("span",null," Asignar Boletas ",-1),Le={class:"px-6 py-4 overflow-y-auto relative max-h-[55dvh]"},Ve={className:"w-full max-w-3xl grid grid-cols-5 md:grid-cols-10 gap-x-2 gap-y-2 place-items-center"},Ae=a("span",null,"Asignar",-1),Fe={class:"flex flex-row gap-2 justify-start items-center"},Ge=a("span",null," Remover Boleta ",-1),Ye={class:"flex flex-row gap-2 justify-center items-center p-4"},Pe=a("span",null,"Remover",-1),Ue=a("header",{class:"hidden print:block print:!fixed print:top-0"},"SÁNCHEZ INVERSIONES",-1),ss=ue({__name:"SellerRaffleView",setup(ze){const I=fe(),y=I.currentRoute.value.params.id,k=I.currentRoute.value.params.seller_id,T=c(),q=c(),L=c(),V=c([]),N=c([]),h=c(null),S=c(!1),C=c(!1),i=c(!1),D=c(""),j=c(null),se=Y(()=>{const e=Array.from(new Set(N.value.map(d=>d.number[0]))).map(d=>({group:d,sellerTickets:N.value.filter(p=>p.number[0]===d)}));return[{group:"0",sellerTickets:[]},{group:"1",sellerTickets:[]},{group:"2",sellerTickets:[]},{group:"3",sellerTickets:[]},{group:"4",sellerTickets:[]},{group:"5",sellerTickets:[]},{group:"6",sellerTickets:[]},{group:"7",sellerTickets:[]},{group:"8",sellerTickets:[]},{group:"9",sellerTickets:[]}].map(d=>{const p=e.find(w=>w.group===d.group);return p==null||p.sellerTickets.sort((w,$)=>Number(w.number)-Number($.number)),p||d})}),te=Y(()=>(console.log(D.value),D.value?V.value.filter(t=>t.number[0]===D.value):[])),ae=t=>{D.value=t,he(()=>{S.value=!0})},re=t=>{var e,_;(e=h.value)!=null&&e.includes(t.id)?h.value=(_=h.value)==null?void 0:_.filter(d=>d!==t.id):h.value=[...h.value??[],t.id]},le=t=>{var e;return(e=h.value)==null?void 0:e.includes(t.id)},oe=async()=>{const{data:t,error:e}=await b.from("raffle_stats").select("*").eq("raffle_id",y).single();if(e)throw new Error(e.message);T.value=t},ne=async()=>{const{data:t,error:e}=await b.from("sellers").select("*").eq("id",k).single();if(e)throw new Error(e.message);q.value=t},M=async()=>{const{data:t,error:e}=await b.from("tickets").select("*").eq("raffle_id",y).eq("seller_id",k);if(e)throw new Error(e.message);N.value=t},O=async()=>{const{data:t,error:e}=await b.from("tickets").select("*").eq("raffle_id",y).is("seller_id",null);if(e)throw new Error(e.message);V.value=t},B=async()=>{const{data:t,error:e}=await b.from("raffles_sellers").select("*").eq("raffle_id",y).eq("seller_id",k).single();if(e)throw new Error(e.message);L.value=t},ie=async()=>{var e;i.value=!0;const{error:t}=await b.from("tickets").update({seller_id:Number(k)}).in("id",(e=h.value)==null?void 0:e.map(_=>Number(_)));if(t)throw new Error(t.message);B(),O(),M(),i.value=!1,S.value=!1},de=async t=>{i.value=!0;const{error:e}=await b.from("tickets").update({seller_id:null}).eq("id",t);if(e)throw new Error(e.message);B(),O(),M(),i.value=!1,C.value=!1},A=t=>{C.value=!0,j.value=t};return pe(()=>{oe(),ne(),B(),M(),O()}),(t,e)=>{var d,p,w,$,F,G;const _=me("auto-animate");return n(),x("div",xe,[a("div",ye,[a("div",null,[a("h1",ke,u((d=T.value)==null?void 0:d.raffle_name),1),a("h2",Te,u((p=q.value)==null?void 0:p.name),1),a("p",null,u((w=q.value)==null?void 0:w.phone),1)]),a("div",Se,[a("p",null,u(s(be)(($=L.value)==null?void 0:$.ticket_price)),1),a("p",null,u((F=T.value)==null?void 0:F.lottery_name),1),a("p",Ce,u(s(_e)(new Date(Date.parse((G=T.value)==null?void 0:G.draw_drawn_at)),"dddd DD [de] MMMM [de] YYYY")),1)])]),a("div",De,[(n(!0),x(E,null,R(se.value,o=>(n(),x("div",{key:o.group,class:"flex items-center gap-4 print:gap-1 border p-4 print:p-2 rounded-md break-before-auto"},[a("div",$e,[a("h3",Ee,u(o.group),1)]),a("div",Re,[(n(!0),x(E,null,R(o.sellerTickets,m=>(n(),g(s(we),{key:m.id,as:"button",class:"ml-2 button small",onTrigger:ce=>A(m)},{default:r(()=>[l(s(f),{variant:"ghost",onContextmenu:ve(ce=>A(m),["prevent"]),class:"border-primary print:min-w-10 print:min-h-10 print:w-10 print:h-10 print:text-sm print:font-extrabold print:rounded-md text-lg min-w-14 min-h-14 w-14 h-14 border rounded-full flex-col justify-center items-center"},{default:r(()=>[a("span",qe,u(m.number),1)]),_:2},1032,["onContextmenu"])]),_:2},1032,["onTrigger"]))),128)),l(s(f),{onClick:m=>ae(o.group),variant:"ghost",class:"print:hidden text-lg w-14 h-14 border rounded-full"},{default:r(()=>[v(" + ")]),_:2},1032,["onClick"])])]))),128)),a("div",Ne,[je,a("div",Me,[(n(),x(E,null,R(14,o=>l(s(f),{key:o,variant:"ghost",class:"print:min-w-10 print:min-h-10 print:w-10 print:h-10 user-select-none text-lg w-14 h-14 border rounded-md border-primary"},{default:r(()=>[a("span",Oe,u(o+1),1)]),_:2},1024)),64)),l(s(f),{variant:"ghost",class:"print:hidden text-lg w-14 h-14 border"},{default:r(()=>[v(" + ")]),_:1})])])]),l(s(K),{open:S.value,"onUpdate:open":e[0]||(e[0]=o=>S.value=o)},{default:r(()=>[l(s(Q),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:r(()=>[l(s(Z),{class:"p-6 pb-4 border-b"},{default:r(()=>[l(s(J),null,{default:r(()=>[a("div",Be,[l(s(z),{class:"w-8 h-8"}),Ie])]),_:1}),l(s(W),null,{default:r(()=>[v(" Seleccione una o más boletas para asignarlas a este vendedor ")]),_:1})]),_:1}),a("div",Le,[a("div",Ve,[(n(!0),x(E,null,R(te.value,o=>(n(),g(s(f),{key:o.id,variant:"ghost",class:ge(["text-lg w-14 h-14 border rounded-full",{"bg-green-600 hover:bg-green-700":le(o)}]),onClick:m=>re(o),disabled:i.value},{default:r(()=>[v(u(o.number),1)]),_:2},1032,["class","onClick","disabled"]))),128))])]),l(s(X),{class:"p-6 pt-4 border-t gap-2"},{default:r(()=>[l(s(ee),{"as-child":""},{default:r(()=>[l(s(f),{variant:"secondary",type:"button",disabled:i.value},{default:r(()=>[v("Cancelar")]),_:1},8,["disabled"])]),_:1}),P((n(),g(s(f),{onClick:ie,class:"gap-3",form:"raffle-form",type:"submit",disabled:i.value},{default:r(()=>[i.value?(n(),g(s(U),{key:0,class:"h-6 w-6"})):(n(),g(s(H),{key:1,class:"w-6 h-6"})),Ae]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"]),l(s(K),{open:C.value,"onUpdate:open":e[2]||(e[2]=o=>C.value=o)},{default:r(()=>[l(s(Q),{class:"transition-[opacity,_transform] gap-0 p-0 max-w-2xl w-[calc(100vw-2rem)] max-h-[calc(100dvh-2rem)] rounded-lg grid-rows-[auto_minmax(0,1fr)_auto]"},{default:r(()=>[l(s(Z),{class:"p-6 pb-4 border-b"},{default:r(()=>[l(s(J),null,{default:r(()=>[a("div",Fe,[l(s(z),{class:"w-8 h-8"}),Ge])]),_:1}),l(s(W),null,{default:r(()=>[v(" Esta acción removerá la boleta de este vendedor ")]),_:1})]),_:1}),a("div",Ye,[l(s(f),{variant:"ghost",class:"text-4xl w-32 h-32 border rounded-full",disabled:i.value},{default:r(()=>{var o;return[v(u((o=j.value)==null?void 0:o.number),1)]}),_:1},8,["disabled"])]),l(s(X),{class:"p-6 pt-4 border-t gap-2"},{default:r(()=>[l(s(ee),{"as-child":""},{default:r(()=>[l(s(f),{variant:"secondary",type:"button",disabled:i.value},{default:r(()=>[v("Cancelar")]),_:1},8,["disabled"])]),_:1}),P((n(),g(s(f),{onClick:e[1]||(e[1]=o=>{var m;return de((m=j.value)==null?void 0:m.id)}),class:"gap-3",form:"raffle-form",type:"button",variant:"destructive",disabled:i.value},{default:r(()=>[i.value?(n(),g(s(U),{key:0,class:"h-6 w-6"})):(n(),g(s(H),{key:1,class:"w-6 h-6"})),Pe]),_:1},8,["disabled"])),[[_]])]),_:1})]),_:1})]),_:1},8,["open"]),Ue])}}});export{ss as default};
